// https://github.com/JarenChow/Janvas Created by JarenChow in 2020 janvas.js v2.4.5
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).janvas=factory()}(this,function(){"use strict";function Utils(){}function Rgb(red,green,blue,alpha){this.init(red,green,blue,alpha)}function Hsl(hue,saturation,lightness,alpha){this.init(hue,saturation,lightness,alpha)}function Matrix(){this.offsetX=Matrix.DEFAULT_OFFSET_X,this.offsetY=Matrix.DEFAULT_OFFSET_Y,this.angle=Matrix.DEFAULT_ANGLE,this._cos=Matrix.DEFAULT_COS,this._sin=Matrix.DEFAULT_SIN,this.scaleX=Matrix.DEFAULT_SCALE_X,this.scaleY=Matrix.DEFAULT_SCALE_Y,this.skewX=Matrix.DEFAULT_SKEW_X,this._tanX=Matrix.DEFAULT_TAN_X,this.skewY=Matrix.DEFAULT_SKEW_Y,this._tanY=Matrix.DEFAULT_TAN_Y,this._tanV=Matrix.DEFAULT_TAN_V}function FillStrokeStyle(){this.fillStyle=FillStrokeStyle.DEFAULT_FILL_STYLE,this.strokeStyle=FillStrokeStyle.DEFAULT_STROKE_STYLE}function TextStyle(){FillStrokeStyle.call(this),this.font=TextStyle.DEFAULT_FONT,this.textAlign=TextStyle.DEFAULT_TEXT_ALIGN,this.textBaseline=TextStyle.DEFAULT_TEXT_BASELINE}function ShapeStyle(){FillStrokeStyle.call(this),this.lineDash=ShapeStyle.DEFAULT_LINE_DASH,this.lineDashOffset=ShapeStyle.DEFAULT_LINE_DASH_OFFSET,this.lineWidth=ShapeStyle.DEFAULT_LINE_WIDTH}function ShadowStyle(){this.shadowBlur=ShadowStyle.DEFAULT_SHADOW_BLUR,this.shadowColor=ShadowStyle.DEFAULT_SHADOW_COLOR,this.shadowOffsetX=ShadowStyle.DEFAULT_SHADOW_OFFSET_X,this.shadowOffsetY=ShadowStyle.DEFAULT_SHADOW_OFFSET_Y}function OtherStyle(){this.lineCap=OtherStyle.DEFAULT_LINE_CAP,this.lineJoin=OtherStyle.DEFAULT_LINE_JOIN,this.miterLimit=OtherStyle.DEFAULT_MITER_LIMIT,this.direction=OtherStyle.DEFAULT_DIRECTION,this.imageSmoothingEnabled=OtherStyle.DEFAULT_IMAGE_SMOOTHING_ENABLED,this.imageSmoothingQuality=OtherStyle.DEFAULT_IMAGE_SMOOTHING_QUALITY}function Point(x,y){this.init(x,y)}function Collision(){}function Config(ctx){this.ctx=ctx}function ImgData(){}function Animate(func,duration,interval){this.func=func,this.duration=duration||1/0,this.interval=interval,this._requestId=void 0,this._loopBind=this._loop.bind(this)}function AnimateITV(func,duration,interval){Animate.call(this,func,duration,interval||16)}function AnimateRAF(func,duration,interval){Animate.call(this,func,duration,interval)}function BasicShape(ctx,sx,sy,cx,cy){this.ctx=ctx,this.init(sx,sy,isNaN(cx)?0:cx,isNaN(cy)?0:cy),this.setMatrix(new Matrix)}function Shape(ctx,sx,sy,cx,cy){BasicShape.call(this,ctx,sx,sy,cx,cy),this.setStyle(new ShapeStyle)}function Rect(ctx,sx,sy,sw,sh,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.setWidth(sw).setHeight(sh)}function RoundRect(ctx,sx,sy,sw,sh,r,cx,cy){Rect.call(this,ctx,sx,sy,sw,sh,cx,cy),this.setRadius(r)}function Image(ctx,sx,sy,src,cx,cy,sw,sh,isx,isy,isw,ish){Rect.call(this,ctx,sx,sy,sw,sh,cx,cy),this.setAdjustSize(isNaN(sw)||isNaN(sh)).setCropX(isx).setCropY(isy).setCropWidth(isw).setCropHeight(ish).setSrc(src)}function Arc(ctx,sx,sy,r,startAngle,endAngle,anticlockwise,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.setRadius(r).setStartAngle(isNaN(startAngle)?0:startAngle).setEndAngle(isNaN(endAngle)?2*Math.PI:endAngle).setAnticlockwise(void 0!==anticlockwise&&anticlockwise)}function Sector(ctx,sx,sy,r,startAngle,endAngle,anticlockwise,cx,cy){Arc.call(this,ctx,sx,sy,r,startAngle,endAngle,anticlockwise,cx,cy)}function Ellipse(ctx,sx,sy,radiusX,radiusY,rotation,startAngle,endAngle,anticlockwise,cx,cy){Arc.call(this,ctx,sx,sy,radiusX,startAngle,endAngle,anticlockwise,cx,cy),this.setRadiusY(radiusY).setRotation(isNaN(rotation)?0:rotation)}function Line(ctx,sx,sy,ex,ey,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.setEndX(ex).setEndY(ey)}function BezierLine(ctx,sx,sy,ex,ey,cp1x,cp1y,cp2x,cp2y,cx,cy){Line.call(this,ctx,sx,sy,ex,ey,cx,cy),this.setControlPoint1X(cp1x).setControlPoint1Y(cp1y).setControlPoint2X(cp2x).setControlPoint2Y(cp2y)}function Edge(ctx,sx,sy,ex,ey,ax,ay,el,cx,cy){Line.call(this,ctx,sx,sy,ex,ey,ax,ay,cx,cy),this.setAngleX(ax).setAngleY(ay).setEmptyLength(isNaN(el)?0:el)}function ArrowHead(ctx,sx,sy,an,closed,al,aa,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.setAngle(isNaN(an)?0:an).setClosed(void 0!==closed&&closed).setArrowLength(isNaN(al)?10:al).setArrowAngle(isNaN(aa)?Math.PI/6:aa)}function Arrow(ctx,sx,sy,ex,ey,ax,ay,el,closed,al,aa,cx,cy){ArrowHead.call(this,ctx,sx,sy,void 0,closed,al,aa,cx,cy),this.setEndX(ex).setEndY(ey).setAngleX(ax).setAngleY(ay).setEmptyLength(isNaN(el)?0:el)}function RegularPolygon(ctx,sx,sy,r,sides,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.setRadius(r).setSides(sides)}function RegularStar(ctx,sx,sy,r,sides,cx,cy){RegularPolygon.call(this,ctx,sx,sy,r,sides,cx,cy)}function Text(ctx,sx,sy,text,cx,cy){BasicShape.call(this,ctx,sx,sy,cx,cy),this.setStyle(new TextStyle).setText(text)}function DotShape(ctx,sx,sy,points,length,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.points=points,this.setLength(length||points.length)._initDataPoints()._initCache()}function Polyline(ctx,sx,sy,points,length,cx,cy){DotShape.call(this,ctx,sx,sy,points,length,cx,cy)}function Bezier(ctx,sx,sy,points,length,cx,cy){Polyline.call(this,ctx,sx,sy,points,length||200,cx,cy)}function Polygon(ctx,sx,sy,points,length,cx,cy){DotShape.call(this,ctx,sx,sy,points,length,cx,cy)}function PolyRect(ctx,sx,sy,points,length,cx,cy){Polygon.call(this,ctx,sx,sy,points,length||8,cx,cy)}function PolyArc(ctx,sx,sy,points,length,cx,cy){Polygon.call(this,ctx,sx,sy,points,length||34,cx,cy)}function SmoothLine(ctx,sx,sy,points,length,cx,cy){DotShape.call(this,ctx,sx,sy,points,length?3*length-4:3*points.length-4,cx,cy)}function Dots(ctx,sx,sy,points,length,r,cx,cy){DotShape.call(this,ctx,sx,sy,points,length,cx,cy),this.setRadius(r||3)}function FixedShape(ctx,sx,sy,path,cx,cy){Shape.call(this,ctx,sx,sy,cx,cy),this.setPath(path)}function FixedRect(ctx,sx,sy,sw,sh,cx,cy){FixedShape.call(this,ctx,sx,sy,void 0,cx,cy),this.sw=sw,this.sh=sh,this.process()}function FixedArc(ctx,sx,sy,r,startAngle,endAngle,anticlockwise,cx,cy){FixedShape.call(this,ctx,sx,sy,void 0,cx,cy),this.r=r,this.startAngle=isNaN(startAngle)?0:startAngle,this.endAngle=isNaN(endAngle)?2*Math.PI:endAngle,this.anticlockwise=anticlockwise||!1,this.process()}function Canvas(options){var $=this;$.$container=options?"[object String]"===Utils._toString.call(options.container)?document.querySelector(options.container):options.container:void 0,$.$container&&(void 0===($.$wrapper=$.$container.children[0])&&$.$container.appendChild($.$wrapper=document.createElement("div")),void 0===$.$wrapper._count&&($.$wrapper._count=0,$.$wrapper.style.position="relative",$.$wrapper.style.height=$.$wrapper.style.width="100%",$.$wrapper.style.overflow="hidden"),0==$.$wrapper._count++&&(Utils._resizeObserver.observe($.$wrapper),Utils._intersectionObserver.observe($.$wrapper)),$.$canvas=document.createElement("canvas"),$.$canvas.style.position="absolute",($.$wrapper.appendChild($.$canvas)._context=$).$ctx=$.$canvas.getContext("2d",{alpha:!0,desynchronized:!1}),$.$cfg=new Config($.$ctx),$.$raf=new AnimateRAF(function(timestamp){this.update(timestamp),this.draw()}.bind($),$.$duration=options.duration,$.$interval=options.interval),$._visible=!1,$.merge(options.props).merge(options.components).merge(options.methods).merge(options.events).merge(options.functions),$._resize().init(),$.resize(),$.draw(),$._initListeners(),$._addListeners())}return Utils._canvas=document.createElement("canvas"),Utils._ctx=Utils._canvas.getContext("2d",{alpha:!0,desynchronized:!1}),Utils._FONT_CACHE=new Map,Utils._IMAGE_CACHE=new Map,Utils._toString=Object.prototype.toString,Utils._resizeObserver=new ResizeObserver(function(entries){entries.forEach(function(entry){for(var context,children=entry.target.children,i=0;i<children.length;i++)!(context=children[i]._context)||context.$width===Math.round(entry.contentRect.right-entry.contentRect.left)&&context.$height===Math.round(entry.contentRect.bottom-entry.contentRect.top)||(context._resize().resize(),context.draw())})}),Utils._intersectionObserver=new IntersectionObserver(function(entries){entries.forEach(function(entry){for(var context,visible,children=entry.target.children,i=0;i<children.length;i++)(context=children[i]._context)&&context._visible!==(visible=0!==entry.intersectionRatio)&&context.visibility(context._visible=visible)})}),Utils.$ls={get:function(key){var value=localStorage.getItem(key);if(!value)return!1;try{return JSON.parse(decodeURIComponent(escape(atob(value))))}catch(e){return value}},set:function(key,value){localStorage.setItem(key,btoa(unescape(encodeURIComponent(JSON.stringify(value)))))},remove:function(key){localStorage.removeItem(key)},clear:function(){localStorage.clear()}},Utils.noop=function(){return this},Utils.inheritPrototype=function(subType){subType.prototype=Object.create(arguments[1].prototype),Utils.defineConstructor(subType);for(var i=2;i<arguments.length;i++){var key,proto=arguments[i].prototype;for(key in proto)subType.prototype.hasOwnProperty(key)||(subType.prototype[key]=proto[key])}},Utils.defineConstructor=function(subType){Object.defineProperty(subType.prototype,"constructor",{value:subType,enumerable:!1})},Utils.measureTextWidth=function(text,font){return Utils.measureText(text,font).width},Utils.measureTextFontSize=function(text,width,fontFamily,min,max){return 0===text.length||0===width?0:(void 0===min&&(min=Math.floor(width/text.length)),void 0===max&&(max=Math.ceil(width/text.length*4)),function searchFontSize(min,max){{if(min===max)return min;if(min+1===max)return Utils.measureTextWidth(text,max+"px "+fontFamily)>width?min:max}var sep=Math.floor((min+max)/2),textWidth=Utils.measureTextWidth(text,sep+"px "+fontFamily);return width<textWidth?searchFontSize(min,sep-1):textWidth<width?searchFontSize(sep,max):sep}(min,max))},Utils.measureText=function(text,font){var metrics=Utils._ctx,fontCache=Utils._FONT_CACHE.get(font);void 0===fontCache&&(fontCache=new Map,Utils._FONT_CACHE.set(font,fontCache));var textCache=fontCache.get(text);return void 0===textCache&&(metrics.CURRENT_FONT!==font&&(metrics.font=metrics.CURRENT_FONT=font),textCache={width:(metrics=metrics.measureText(text)).width,height:metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent,offsetY:(metrics.actualBoundingBoxAscent-metrics.actualBoundingBoxDescent)/2},fontCache.set(text,textCache)),textCache},Utils.loadImage=function(src,callback,context){var image=Utils._IMAGE_CACHE.get(src);void 0===image?((image=document.createElement("img")).addEventListener("load",function(){callback.call(context,this)},{once:!0}),image.src=src,Utils._IMAGE_CACHE.set(src,image)):image.complete?callback.call(context,image):image.addEventListener("load",function(){callback.call(context,this)},{once:!0})},Utils.loadImages=function(srcs,callback,context){var key,images={},loaded=0,length=Object.keys(srcs).length;for(key in srcs)Utils.loadImage(srcs[key],function(image){images[this]=image,++loaded===length&&callback.call(context,images)},key)},Utils.createLinearGradient=function(x0,y0,x1,y1,basicShape){return basicShape&&(x0+=basicShape._sx,y0+=basicShape._sy,x1+=basicShape._sx,y1+=basicShape._sy),Utils._ctx.createLinearGradient(x0,y0,x1,y1)},Utils.createRadialGradient=function(x0,y0,r0,x1,y1,r1,basicShape){return basicShape&&(x0+=basicShape._sx,y0+=basicShape._sy,x1+=basicShape._sx,y1+=basicShape._sy),Utils._ctx.createRadialGradient(x0,y0,r0,x1,y1,r1)},Utils.createPattern=function(image,pattern,matrix){pattern=Utils._ctx.createPattern(image,pattern||"repeat");return matrix&&pattern.setTransform({a:matrix.getM11(),b:matrix.getM12(),c:matrix.getM21(),d:matrix.getM22(),e:matrix.offsetX,f:matrix.offsetY}),pattern},Utils.saveAsImage=function(imageData,filename){var a=document.createElement("a");a.href=Utils.imageData2DataURL(imageData),a.download=filename?filename+".png":"canvas.png",a.click()},Utils.cloneImageData=function(imageData){var dst=Utils._ctx.createImageData(imageData);return dst.data.set(imageData.data),dst},Utils.image2ImageData=function(image){return Utils._resetArea(image),Utils._ctx.drawImage(image,0,0),Utils._ctx.getImageData(0,0,image.width,image.height)},Utils.imageData2DataURL=function(imageData){return Utils._resetArea(imageData),Utils._ctx.putImageData(imageData,0,0),Utils._canvas.toDataURL()},Utils._resetArea=function(img){Utils._canvas.width=img.width,Utils._canvas.height=img.height},Utils.randInt=function(start_or_end,end,containsEnd){return 1===arguments.length?Math.floor(Math.random()*start_or_end):containsEnd?Math.floor(Math.random()*(end-start_or_end+1))+start_or_end:Math.floor(Math.random()*(end-start_or_end))+start_or_end},Utils.randSign=function(){return.5<Math.random()?1:-1},Utils.factorial=function(n){switch(n){case 9:return 362880;case 8:return 40320;case 7:return 5040;case 6:return 720;case 5:return 120;case 4:return 24;case 3:return 6;case 2:return 2;case 1:case 0:return 1}return n*Utils.factorial(n-1)},Utils.permutation=function(n,m){return Utils.factorial(m)/Utils.factorial(m-n)},Utils.combination=function(n,m){return 0===n||n===m?1:1===n||m-n==1?m:Utils.factorial(m)/(Utils.factorial(n)*Utils.factorial(m-n))},Utils.pythagorean=function(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))},Utils.deg2rad=function(degree){return.017453292519943295*degree},Utils.rad2deg=function(radian){return 57.29577951308232*radian},Utils.unique=function(array){return Array.from(new Set(array))},Utils.jsonClone=function(obj){return JSON.parse(JSON.stringify(obj))},Utils.speedTest=function(func,times,tag){tag+=" "+times.toLocaleString()+" times",console.time(tag);for(var i=0;i<times;i++)func();console.timeEnd(tag)},Utils.debounce=function(func,delay,immediate){var timeoutID;return function(){var callNow,context=this,args=arguments;timeoutID&&clearTimeout(timeoutID),immediate?(callNow=!timeoutID,timeoutID=setTimeout(function(){timeoutID=void 0},delay),callNow&&func.apply(context,args)):timeoutID=setTimeout(function(){func.apply(context,args)},delay)}},Utils.throttle=function(func,delay,useTime){var previous,timeoutID;return useTime&&(previous=0),function(){var now,context=this,args=arguments;useTime?(now=performance.now(),delay<now-previous&&(func.apply(context,args),previous=now)):timeoutID=timeoutID||setTimeout(function(){timeoutID=void 0,func.apply(context,args)},delay)}},Rgb.RGB="rgb",Rgb.RGBA="rgba",Rgb.LEFTPARENTHESIS="(",Rgb.RIGHTPARENTHESIS=")",Rgb.COMMA=", ",Rgb.HEX="#",Rgb.HEX_PREFIX="0x",Rgb.HEX_MAP=new Map([[0,"0"],[1,"1"],[2,"2"],[3,"3"],[4,"4"],[5,"5"],[6,"6"],[7,"7"],[8,"8"],[9,"9"],[10,"a"],[11,"b"],[12,"c"],[13,"d"],[14,"e"],[15,"f"]]),Rgb.REGEX_RGB=/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3}),? ?([0,1]\.?\d*)?\)/,Rgb.REGEX_HEX=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,Rgb.copy=function(rgb1,rgb2){return rgb1.init(rgb2.red,rgb2.green,rgb2.blue,rgb2.alpha)},Rgb.clone=function(rgb){return new Rgb(rgb.red,rgb.green,rgb.blue,rgb.alpha)},Rgb.fromRgbString=function(reg){reg=Rgb.REGEX_RGB.exec(reg);return new Rgb(parseInt(reg[1]),parseInt(reg[2]),parseInt(reg[3]),Math.round(255*parseFloat(reg[4])))},Rgb.fromHexString=function(reg){reg=Rgb.REGEX_HEX.exec(reg);return new Rgb(parseInt(Rgb.HEX_PREFIX+reg[1]),parseInt(Rgb.HEX_PREFIX+reg[2]),parseInt(Rgb.HEX_PREFIX+reg[3]),parseInt(Rgb.HEX_PREFIX+reg[4]))},Rgb.fromRgb=function(rgb){return new Rgb(rgb.red,rgb.green,rgb.blue,rgb.alpha)},Rgb.fromHsl=function(hsl){var r,g,h=hsl.hue,b=hsl.saturation/100,m=hsl.lightness/100,c=(1-Math.abs(2*m-1))*b,b=c*(1-Math.abs(h/60%2-1)),m=m-c/2,b=h<60?(r=c,g=b,0):h<120?(r=b,g=c,0):h<180?(r=0,g=c,b):h<240?(r=0,g=b,c):h<300?(r=b,g=0,c):(r=c,g=0,b);return new Rgb(Math.round(255*(r+m)),Math.round(255*(g+m)),Math.round(255*(b+m)),hsl.alpha)},Rgb.randomRgb=function(randomAlpha){return new Rgb(Utils.randInt(256),Utils.randInt(256),Utils.randInt(256),randomAlpha?Utils.randInt(256):255)},Rgb.mix=function(back,front){var alpha=isNaN(front.alpha)?1:front.alpha/255;return new Rgb(Math.round((1-alpha)*back.red+alpha*front.red),Math.round((1-alpha)*back.green+alpha*front.green),Math.round((1-alpha)*back.blue+alpha*front.blue))},Rgb.extractFront=function(back1,result1,back2_or_alpha,result2){if(3===arguments.length){var alpha=back2_or_alpha/255;return new Rgb(Math.round(back1.red+(result1.red-back1.red)/alpha),Math.round(back1.green+(result1.green-back1.green)/alpha),Math.round(back1.blue+(result1.blue-back1.blue)/alpha),back2_or_alpha)}if(4===arguments.length)return Rgb.extractFront(back1,result1,Math.round(255*(1-(result1.red-result2.red)/(back1.red-back2_or_alpha.red)))||Math.round(255*(1-(result1.green-result2.green)/(back1.green-back2_or_alpha.green)))||Math.round(255*(1-(result1.blue-result2.blue)/(back1.blue-back2_or_alpha.blue)))||128)},Rgb.prototype.sRgbInverseCompanding=function(){return this.red=this._sRgbInverseCompanding(this.red),this.green=this._sRgbInverseCompanding(this.green),this.blue=this._sRgbInverseCompanding(this.blue),this},Rgb.prototype._sRgbInverseCompanding=function(c){return.04045<(c/=255)?Math.pow((c+.055)/1.055,2.4):c/12.92},Rgb.prototype.sRgbCompanding=function(){return this.red=this._sRgbCompanding(this.red),this.green=this._sRgbCompanding(this.green),this.blue=this._sRgbCompanding(this.blue),this},Rgb.prototype._sRgbCompanding=function(c){return 255*(c=.0031308<c?1.055*Math.pow(c,1/2.4)-.055:12.92*c)},Rgb.prototype.sRgbInverseGammaMixing=function(srgb1,srgb2,lambda){return this.red=srgb1.red*(1-lambda)+srgb2.red*lambda,this.green=srgb1.green*(1-lambda)+srgb2.green*lambda,this.blue=srgb1.blue*(1-lambda)+srgb2.blue*lambda,this},Rgb.prototype.sRgbMarksGammaMixing=function(bright1,intensity,sum){this.sRgbInverseGammaMixing(bright1,intensity,sum);bright1=Math.pow(bright1.red+bright1.green+bright1.blue,.43),intensity=Math.pow(intensity.red+intensity.green+intensity.blue,.43),intensity=Math.pow(bright1*(1-sum)+intensity*sum,1/.43),sum=this.red+this.green+this.blue;return 0!==sum&&(this.red*=intensity/sum,this.green*=intensity/sum,this.blue*=intensity/sum),this},Rgb.prototype.toRgbString=function(containsAlpha){return(containsAlpha?Rgb.RGBA:Rgb.RGB)+Rgb.LEFTPARENTHESIS+this.red+Rgb.COMMA+this.green+Rgb.COMMA+this.blue+(containsAlpha?Rgb.COMMA+this.alpha/255:"")+Rgb.RIGHTPARENTHESIS},Rgb.prototype.toHexString=function(containsAlpha){return Rgb.HEX+Rgb.HEX_MAP.get(Math.floor(this.red/16))+Rgb.HEX_MAP.get(this.red%16)+Rgb.HEX_MAP.get(Math.floor(this.green/16))+Rgb.HEX_MAP.get(this.green%16)+Rgb.HEX_MAP.get(Math.floor(this.blue/16))+Rgb.HEX_MAP.get(this.blue%16)+(containsAlpha?Rgb.HEX_MAP.get(Math.floor(this.alpha/16))+Rgb.HEX_MAP.get(this.alpha%16):"")},Rgb.prototype.init=function(red,green,blue,alpha){return this.red=red,this.green=green,this.blue=blue,this.alpha=alpha,this},Rgb.prototype.equals=function(rgb){return void 0!==rgb&&(rgb===this||this.red===rgb.red&&this.green===rgb.green&&this.blue===rgb.blue&&this.alpha===rgb.alpha)},Rgb.prototype.copy=function(rgb){return this.init(rgb.red,rgb.green,rgb.blue,rgb.alpha)},Rgb.prototype.clone=function(){return new Rgb(this.red,this.green,this.blue,this.alpha)},Rgb.prototype.getRed=function(){return this.red},Rgb.prototype.setRed=function(red){return this.red=red,this},Rgb.prototype.getGreen=function(){return this.green},Rgb.prototype.setGreen=function(green){return this.green=green,this},Rgb.prototype.getBlue=function(){return this.blue},Rgb.prototype.setBlue=function(blue){return this.blue=blue,this},Rgb.prototype.getAlpha=function(){return this.alpha},Rgb.prototype.setAlpha=function(alpha){return this.alpha=alpha,this},Hsl.HSL="hsl",Hsl.HSLA="hsla",Hsl.LEFTPARENTHESIS="(",Hsl.RIGHTPARENTHESIS=")",Hsl.COMMA=", ",Hsl.PERCENT="%",Hsl.REGEX_HSL=/hsla?\((\d{1,3}\.?\d?), ?(\d{1,3}\.?\d?)%, ?(\d{1,3}\.?\d?)%,? ?([0,1]\.?\d*)?\)/,Hsl.copy=function(hsl1,hsl2){return hsl1.init(hsl2.hue,hsl2.saturation,hsl2.lightness,hsl2.alpha)},Hsl.clone=function(hsl){return new Hsl(hsl.hue,hsl.saturation,hsl.lightness,hsl.alpha)},Hsl.fromHslString=function(reg){reg=Hsl.REGEX_HSL.exec(reg);return new Hsl(parseFloat(reg[1]),parseFloat(reg[2]),parseFloat(reg[3]),Math.round(255*parseFloat(reg[4])))},Hsl.fromHsl=function(hsl){return new Hsl(hsl.hue,hsl.saturation,hsl.lightness,hsl.alpha)},Hsl.fromRgb=function(rgb){var hue,saturation,r=rgb.red/255,g=rgb.green/255,b=rgb.blue/255,max=Math.max(r,g,b),lightness=Math.min(r,g,b),delta=max-lightness,lightness=(max+lightness)/2;return 0==delta?hue=saturation=0:(hue=max===r?(g-b)/delta*60+(g<b?360:0):max===g?(b-r)/delta*60+120:(r-g)/delta*60+240,saturation=delta/(1-Math.abs(2*lightness-1))),new Hsl(Math.round(10*hue)/10,Math.round(1e3*saturation)/10,Math.round(1e3*lightness)/10,rgb.alpha)},Hsl.randomHsl=function(randomAlpha){return new Hsl(Utils.randInt(3600)/10,Utils.randInt(1e3)/10,Utils.randInt(1e3)/10,randomAlpha?Utils.randInt(256):255)},Hsl.prototype.toHslString=function(containsAlpha){return(containsAlpha?Hsl.HSLA:Hsl.HSL)+Hsl.LEFTPARENTHESIS+this.hue+Hsl.COMMA+this.saturation+Hsl.PERCENT+Hsl.COMMA+this.lightness+Hsl.PERCENT+(containsAlpha?Hsl.COMMA+this.alpha/255:"")+Hsl.RIGHTPARENTHESIS},Hsl.prototype.init=function(hue,saturation,lightness,alpha){return this.hue=hue,this.saturation=saturation,this.lightness=lightness,this.alpha=alpha,this},Hsl.prototype.equals=function(hsl){return void 0!==hsl&&(hsl===this||this.hue===hsl.hue&&this.saturation===hsl.saturation&&this.lightness===hsl.lightness&&this.alpha===hsl.alpha)},Hsl.prototype.copy=function(hsl){return this.init(hsl.hue,hsl.saturation,hsl.lightness,hsl.alpha)},Hsl.prototype.clone=function(){return new Hsl(this.hue,this.saturation,this.lightness,this.alpha)},Hsl.prototype.getHue=function(){return this.hue},Hsl.prototype.setHue=function(hue){return this.hue=hue,this},Hsl.prototype.getSaturation=function(){return this.saturation},Hsl.prototype.setSaturation=function(saturation){return this.saturation=saturation,this},Hsl.prototype.getLightness=function(){return this.lightness},Hsl.prototype.setLightness=function(lightness){return this.lightness=lightness,this},Hsl.prototype.getAlpha=function(){return this.alpha},Hsl.prototype.setAlpha=function(alpha){return this.alpha=alpha,this},Matrix.DEFAULT_SKEW_X=0,Matrix.DEFAULT_TAN_X=0,Matrix.DEFAULT_SKEW_Y=0,Matrix.DEFAULT_TAN_Y=0,Matrix.DEFAULT_TAN_V=1,Matrix.DEFAULT_SCALE_X=1,Matrix.DEFAULT_SCALE_Y=1,Matrix.DEFAULT_ANGLE=0,Matrix.DEFAULT_COS=1,Matrix.DEFAULT_SIN=0,Matrix.DEFAULT_OFFSET_X=0,Matrix.DEFAULT_OFFSET_Y=0,Matrix.prototype.init=function(skewX,skewY,scaleX,scaleY,angle,offsetX,offsetY){return this.skewX!==skewX&&(this.skewX=skewX,this._tanX=Math.tan(skewX)),this.skewY!==skewY&&(this.skewY=skewY,this._tanY=Math.tan(skewY)),this._tanV=1/(1-this._tanX*this._tanY),this.scaleX=scaleX,this.scaleY=scaleY,this.angle!==angle&&(this.angle=angle,this._cos=Math.cos(angle),this._sin=Math.sin(angle)),this.offsetX=offsetX,this.offsetY=offsetY,this},Matrix.prototype.equals=function(matrix){return void 0!==matrix&&(matrix===this||this.angle===matrix.angle&&this.scaleX===matrix.scaleX&&this.scaleY===matrix.scaleY&&this.offsetX===matrix.offsetX&&this.offsetY===matrix.offsetY&&this.skewX===matrix.skewX&&this.skewY===matrix.skewY)},Matrix.prototype.getM11=function(){return this._cos*this.scaleX-this._tanY*this._sin*this.scaleY},Matrix.prototype.getM11i=function(){return this._cos*this._tanV/this.scaleX+this._tanX*this._tanV*this._sin/this.scaleY},Matrix.prototype.getM12=function(){return this._sin*this.scaleX+this._tanY*this._cos*this.scaleY},Matrix.prototype.getM12i=function(){return-this._tanY*this._tanV*this._cos/this.scaleX-this._sin*this._tanV/this.scaleY},Matrix.prototype.getM21=function(){return-this._sin*this.scaleY+this._tanX*this._cos*this.scaleX},Matrix.prototype.getM21i=function(){return this._sin*this._tanV/this.scaleX-this._tanX*this._tanV*this._cos/this.scaleY},Matrix.prototype.getM22=function(){return this._cos*this.scaleY+this._tanX*this._sin*this.scaleX},Matrix.prototype.getM22i=function(){return-this._tanY*this._tanV*this._sin/this.scaleX+this._cos*this._tanV/this.scaleY},Matrix.prototype.getM41=function(){return this.offsetX},Matrix.prototype.getM41i=function(){return-this.offsetX*this.getM11i()-this.offsetY*this.getM21i()},Matrix.prototype.getM42=function(){return this.offsetY},Matrix.prototype.getM42i=function(){return-this.offsetX*this.getM12i()-this.offsetY*this.getM22i()},Matrix.prototype.getSkewX=function(){return this.skewX},Matrix.prototype.setSkewX=function(skewX){return this.skewX!==skewX&&(this.skewX=skewX,this._tanX=Math.tan(skewX),this._tanV=1/(1-this._tanX*this._tanY)),this},Matrix.prototype.getSkewY=function(){return this.skewY},Matrix.prototype.setSkewY=function(skewY){return this.skewY!==skewY&&(this.skewY=skewY,this._tanY=Math.tan(skewY),this._tanV=1/(1-this._tanX*this._tanY)),this},Matrix.prototype.setSkew=function(skewX,skewY){return this.skewX!==skewX&&(this.skewX=skewX,this._tanX=Math.tan(skewX)),this.skewY!==skewY&&(this.skewY=skewY,this._tanY=Math.tan(skewY)),this._tanV=1/(1-this._tanX*this._tanY),this},Matrix.prototype.getScaleX=function(){return this.scaleX},Matrix.prototype.setScaleX=function(scaleX){return this.scaleX=scaleX,this},Matrix.prototype.getScaleY=function(){return this.scaleY},Matrix.prototype.setScaleY=function(scaleY){return this.scaleY=scaleY,this},Matrix.prototype.setScale=function(scaleX,scaleY){return this.scaleX=scaleX,this.scaleY=scaleY,this},Matrix.prototype.getAngle=function(){return this.angle},Matrix.prototype.setAngle=function(angle){return this.angle!==angle&&(this.angle=angle,this._cos=Math.cos(angle),this._sin=Math.sin(angle)),this},Matrix.prototype.getOffsetX=function(){return this.offsetX},Matrix.prototype.setOffsetX=function(offsetX){return this.offsetX=offsetX,this},Matrix.prototype.getOffsetY=function(){return this.offsetY},Matrix.prototype.setOffsetY=function(offsetY){return this.offsetY=offsetY,this},Matrix.prototype.setOffset=function(offsetX,offsetY){return this.offsetX=offsetX,this.offsetY=offsetY,this},FillStrokeStyle.DEFAULT_FILL_STYLE="#000000",FillStrokeStyle.DEFAULT_STROKE_STYLE="#000000",FillStrokeStyle.prototype.getFillStyle=function(){return this.fillStyle},FillStrokeStyle.prototype.setFillStyle=function(fillStyle){return this.fillStyle=fillStyle,this},FillStrokeStyle.prototype.getStrokeStyle=function(){return this.strokeStyle},FillStrokeStyle.prototype.setStrokeStyle=function(strokeStyle){return this.strokeStyle=strokeStyle,this},Utils.inheritPrototype(TextStyle,FillStrokeStyle),TextStyle.DEFAULT_FONT="10px sans-serif",TextStyle.DEFAULT_TEXT_ALIGN="start",TextStyle.DEFAULT_TEXT_BASELINE="alphabetic",TextStyle.prototype.getFont=function(){return this.font},TextStyle.prototype.setFont=function(font){return this.font=font,this},TextStyle.prototype.getTextAlign=function(){return this.textAlign},TextStyle.prototype.setTextAlign=function(textAlign){return this.textAlign=textAlign,this},TextStyle.prototype.getTextBaseline=function(){return this.textBaseline},TextStyle.prototype.setTextBaseline=function(textBaseline){return this.textBaseline=textBaseline,this},Utils.inheritPrototype(ShapeStyle,FillStrokeStyle),ShapeStyle.DEFAULT_LINE_DASH=[],ShapeStyle.DEFAULT_LINE_DASH_OFFSET=0,ShapeStyle.DEFAULT_LINE_WIDTH=1,ShapeStyle.prototype.getLineDash=function(){return this.lineDash},ShapeStyle.prototype.setLineDash=function(lineDash){return this.lineDash=lineDash,this},ShapeStyle.prototype.getLineDashOffset=function(){return this.lineDashOffset},ShapeStyle.prototype.setLineDashOffset=function(lineDashOffset){return this.lineDashOffset=lineDashOffset,this},ShapeStyle.prototype.getLineWidth=function(){return this.lineWidth},ShapeStyle.prototype.setLineWidth=function(lineWidth){return this.lineWidth=lineWidth,this},ShadowStyle.DEFAULT_SHADOW_BLUR=0,ShadowStyle.DEFAULT_SHADOW_COLOR="rgba(0, 0, 0, 0)",ShadowStyle.DEFAULT_SHADOW_OFFSET_X=0,ShadowStyle.DEFAULT_SHADOW_OFFSET_Y=0,ShadowStyle.prototype.getShadowBlur=function(){return this.shadowBlur},ShadowStyle.prototype.setShadowBlur=function(shadowBlur){return this.shadowBlur=shadowBlur,this},ShadowStyle.prototype.getShadowColor=function(){return this.shadowColor},ShadowStyle.prototype.setShadowColor=function(shadowColor){return this.shadowColor=shadowColor,this},ShadowStyle.prototype.getShadowOffsetX=function(){return this.shadowOffsetX},ShadowStyle.prototype.setShadowOffsetX=function(shadowOffsetX){return this.shadowOffsetX=shadowOffsetX,this},ShadowStyle.prototype.getShadowOffsetY=function(){return this.shadowOffsetY},ShadowStyle.prototype.setShadowOffsetY=function(shadowOffsetY){return this.shadowOffsetY=shadowOffsetY,this},OtherStyle.DEFAULT_LINE_CAP="butt",OtherStyle.DEFAULT_LINE_JOIN="miter",OtherStyle.DEFAULT_MITER_LIMIT=10,OtherStyle.DEFAULT_DIRECTION="ltr",OtherStyle.DEFAULT_IMAGE_SMOOTHING_ENABLED=!0,OtherStyle.DEFAULT_IMAGE_SMOOTHING_QUALITY="low",OtherStyle.prototype.getLineCap=function(){return this.lineCap},OtherStyle.prototype.setLineCap=function(lineCap){return this.lineCap=lineCap,this},OtherStyle.prototype.getLineJoin=function(){return this.lineJoin},OtherStyle.prototype.setLineJoin=function(lineJoin){return this.lineJoin=lineJoin,this},OtherStyle.prototype.getMiterLimit=function(){return this.miterLimit},OtherStyle.prototype.setMiterLimit=function(miterLimit){return this.miterLimit=miterLimit,this},OtherStyle.prototype.getDirection=function(){return this.direction},OtherStyle.prototype.setDirection=function(direction){return this.direction=direction,this},OtherStyle.prototype.getImageSmoothingEnabled=function(){return this.imageSmoothingEnabled},OtherStyle.prototype.setImageSmoothingEnabled=function(imageSmoothingEnabled){return this.imageSmoothingEnabled=imageSmoothingEnabled,this},OtherStyle.prototype.getImageSmoothingQuality=function(){return this.imageSmoothingQuality},OtherStyle.prototype.setImageSmoothingQuality=function(imageSmoothingQuality){return this.imageSmoothingQuality=imageSmoothingQuality,this},Point.prototype.init=function(x,y){return this.x=x,this.y=y,this},Point.prototype.equals=function(point){return void 0!==point&&(point===this||this.x===point.x&&this.y===point.y)},Point.prototype.getX=function(){return this.x},Point.prototype.setX=function(x){return this.x=x,this},Point.prototype.getY=function(){return this.y},Point.prototype.setY=function(y){return this.y=y,this},Point.basisX=new Point(1,0),Point.basisY=new Point(0,1),Point.modulus=function(point1,point2){return Math.sqrt(Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2))},Point.slope=function(point1,point2){return(point1.y-point2.y)/(point1.x-point2.x)},Point.radian=function(point1,point2){return Math.atan2(point1.y-point2.y,point1.x-point2.x)},Point.dotProduct=function(point1,point2){return point1.x*point2.x+point1.y*point2.y},Point.crossProduct=function(point1,point2){return point1.x*point2.y-point1.y*point2.x},Point.theta=function(point1,point2){return Math.acos(Point.dotProduct(point1,point2)/(point1.modulus()*point2.modulus()))},Point.offsetX=function(point1,point2){return point1.x-point2.x},Point.offsetY=function(point1,point2){return point1.y-point2.y},Point.copy=function(point1,point2){return point1.init(point2.x,point2.y)},Point.clone=function(point){return new Point(point.x,point.y)},Point.unit=function(point){var modulus=point.modulus();return new Point(point.x/modulus,point.y/modulus)},Point.abs=function(point){return new Point(point.x<0?-point.x:point.x,point.y<0?-point.y:point.y)},Point.inverse=function(point){return new Point(-point.x,-point.y)},Point.inverseX=function(point){return new Point(-point.x,point.y)},Point.inverseY=function(point){return new Point(point.x,-point.y)},Point.vertical=function(point){return new Point(-point.y,point.x)},Point.verticalAnti=function(point){return new Point(point.y,-point.x)},Point.add=function(point1,point2){return new Point(point1.x+point2.x,point1.y+point2.y)},Point.subtract=function(point1,point2){return new Point(point1.x-point2.x,point1.y-point2.y)},Point.multiply=function(point1,point2){return new Point(point1.x*point2.x-point1.y*point2.y,point1.y*point2.x+point1.x*point2.y)},Point.divide=function(point1,point2){var den=Math.pow(point2.x,2)+Math.pow(point2.y,2);return new Point((point1.x*point2.x+point1.y*point2.y)/den,(point1.y*point2.x-point1.x*point2.y)/den)},Point.inline=function(point1,point2,lambda){return new Point(point1.x+(point2.x-point1.x)*lambda,point1.y+(point2.y-point1.y)*lambda)},Point.lambda2point=function(point1,point2){return 0===point2.x?point1.y/point2.y:point1.x/point2.x},Point.lambda2line=function(point1,point2,point3){return point2.x===point3.x?(point1.y-point2.y)/(point3.y-point2.y):(point1.x-point2.x)/(point3.x-point2.x)},Point.pointAnti2point=function(point1,point2){return point1.x*point2.y<point1.y*point2.x},Point.pointAnti2line=function(point1,point2,point3){return(point1.x-point2.x)*(point1.y-point3.y)<(point1.y-point2.y)*(point1.x-point3.x)},Point.point2point=function(x2,y2){if(0===y2.x)return new Point(0,x2.y);if(0===y2.y)return new Point(x2.x,0);var x1=x2.x,y1=x2.y,x2=y2.x,y2=y2.y;return new Point((x1*x2*x2+x2*y2*y2+(y1-y2)*x2*y2)/(x2*x2+y2*y2),(y1*y2*y2+y2*x2*x2+(x1-x2)*x2*y2)/(x2*x2+y2*y2))},Point.point2line=function(y2,x3,y3){if(x3.x===y3.x)return new Point(x3.x,y2.y);if(x3.y===y3.y)return new Point(y2.x,x3.y);var x1=y2.x,y1=y2.y,x2=x3.x,y2=x3.y,x3=y3.x,y3=y3.y;return new Point((x1*(x2-x3)*(x2-x3)+x2*(y2-y3)*(y2-y3)+(y1-y2)*(x2-x3)*(y2-y3))/((x2-x3)*(x2-x3)+(y2-y3)*(y2-y3)),(y1*(y2-y3)*(y2-y3)+y2*(x2-x3)*(x2-x3)+(x1-x2)*(x2-x3)*(y2-y3))/((x2-x3)*(x2-x3)+(y2-y3)*(y2-y3)))},Point.line2line=function(b2,a2,den,c2){var a1=a2.y-b2.y,b1=b2.x-a2.x,c1=-a1*b2.x-b1*b2.y,a2=c2.y-den.y,b2=den.x-c2.x,c2=-a2*den.x-b2*den.y,den=a1*b2-a2*b1;return new Point((c2*b1-c1*b2)/den,(c1*a2-c2*a1)/den)},Point.line2arc=function(delta,mp1,point3,x){if(delta.x===mp1.x){var y=Math.sqrt(Math.pow(x,2)-Math.pow(delta.x-point3.x,2));return[new Point(delta.x,point3.y-y),new Point(delta.x,point3.y+y)]}var m=(mp1.y-delta.y)/(mp1.x-delta.x),d=delta.y-m*delta.x,y=Math.pow(m,2),mp1=y+1,delta=Math.sqrt(Math.pow(x,2)*mp1-Math.pow(point3.y-m*point3.x-d,2)),x=point3.x+point3.y*m-d*m,y=d+point3.x*m+point3.y*y;return[new Point((x+delta)/mp1,(y+m*delta)/mp1),new Point((x-delta)/mp1,(y-m*delta)/mp1)]},Point.arc2arc=function(b,n,y,m){var x1=b.x,y1=b.y,x=y.x,y2=y.y,r1p=Math.pow(n,2),r2p=Math.pow(m,2),b=Math.pow(x-x1,2)+Math.pow(y2-y1,2),y=Math.sqrt(b),n=(x-x1)/y,m=(y2-y1)/y,y=(r1p-r2p)/2/y,x=(x1+x)/2+y*n,y=(y1+y2)/2+y*m,b=Math.sqrt((r1p+r2p)/2-Math.pow(r1p-r2p,2)/4/b-b/4),m=b*m,n=-b*n;return[new Point(x+m,y+n),new Point(x-m,y-n)]},Point.arc=function(x3,y3,a){var x1=x3.x,y1=x3.y,x2=y3.x,y2=y3.y,x3=a.x,y3=a.y,a=x1*(y2-y3)-y1*(x2-x3)+x2*y3-x3*y2;return new Point(-((x1*x1+y1*y1)*(y3-y2)+(x2*x2+y2*y2)*(y1-y3)+(x3*x3+y3*y3)*(y2-y1))/a/2,-((x1*x1+y1*y1)*(x2-x3)+(x2*x2+y2*y2)*(x3-x1)+(x3*x3+y3*y3)*(x1-x2))/a/2)},Point.skewX=function(point,skewX){return new Point(point.x+point.y*Math.tan(skewX),point.y)},Point.skewY=function(point,skewY){return new Point(point.x,point.y+point.x*Math.tan(skewY))},Point.skew=function(point,skewX,skewY){return new Point(point.x+point.y*Math.tan(skewX),point.y+point.x*Math.tan(skewY))},Point.scaleX=function(point,scaleX){return new Point(point.x*scaleX,point.y)},Point.scaleY=function(point,scaleY){return new Point(point.x,point.y*scaleY)},Point.scale=function(point,scaleX,scaleY){return new Point(point.x*scaleX,point.y*scaleY)},Point.rotate=function(point,sin){var cos=Math.cos(sin),sin=Math.sin(sin);return new Point(point.x*cos-point.y*sin,point.x*sin+point.y*cos)},Point.translateX=function(point,offsetX){return new Point(point.x+offsetX,point.y)},Point.translateY=function(point,offsetY){return new Point(point.x,point.y+offsetY)},Point.translate=function(point,offsetX,offsetY){return new Point(point.x+offsetX,point.y+offsetY)},Point.transform=function(point,matrix){return new Point(point.x*matrix.getM11()+point.y*matrix.getM21()+matrix.offsetX,point.x*matrix.getM12()+point.y*matrix.getM22()+matrix.offsetY)},Point.resetTransform=function(point,matrix){return new Point((point.x-matrix.offsetX)*matrix.getM11i()+(point.y-matrix.offsetY)*matrix.getM21i(),(point.x-matrix.offsetX)*matrix.getM12i()+(point.y-matrix.offsetY)*matrix.getM22i())},Point.prototype.modulus=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},Point.prototype.slope=function(){return this.y/this.x},Point.prototype.radian=function(){return Math.atan2(this.y,this.x)},Point.prototype.dotProduct=function(point){return this.x*point.x+this.y*point.y},Point.prototype.crossProduct=function(point){return this.x*point.y-this.y*point.x},Point.prototype.theta=function(point){return Math.acos(this.dotProduct(point)/(this.modulus()*point.modulus()))},Point.prototype.offsetX=function(point){return this.x-point.x},Point.prototype.offsetY=function(point){return this.y-point.y},Point.prototype.copy=function(point){return this.init(point.x,point.y)},Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.unit=function(){var modulus=this.modulus();return this.x/=modulus,this.y/=modulus,this},Point.prototype.abs=function(){return this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this},Point.prototype.inverse=function(){return this.x=-this.x,this.y=-this.y,this},Point.prototype.inverseX=function(){return this.x=-this.x,this},Point.prototype.inverseY=function(){return this.y=-this.y,this},Point.prototype.vertical=function(){var y=this.x;return this.x=-this.y,this.y=y,this},Point.prototype.verticalAnti=function(){var y=-this.x;return this.x=this.y,this.y=y,this},Point.prototype.add=function(point){return this.x+=point.x,this.y+=point.y,this},Point.prototype.subtract=function(point){return this.x-=point.x,this.y-=point.y,this},Point.prototype.multiply=function(point){var y=this.y*point.x+this.x*point.y;return this.x=this.x*point.x-this.y*point.y,this.y=y,this},Point.prototype.divide=function(point){var den=Math.pow(point.x,2)+Math.pow(point.y,2),y=(this.y*point.x-this.x*point.y)/den;return this.x=(this.x*point.x+this.y*point.y)/den,this.y=y,this},Point.prototype.inline=function(point,lambda){return this.x+=(point.x-this.x)*lambda,this.y+=(point.y-this.y)*lambda,this},Point.prototype.skewX=function(skewX){return this.x+=this.y*Math.tan(skewX),this},Point.prototype.skewY=function(skewY){return this.y+=this.x*Math.tan(skewY),this},Point.prototype.skew=function(skewX,y){y=this.y+this.x*Math.tan(y);return this.x+=this.y*Math.tan(skewX),this.y=y,this},Point.prototype.scaleX=function(scaleX){return this.x*=scaleX,this},Point.prototype.scaleY=function(scaleY){return this.y*=scaleY,this},Point.prototype.scale=function(scaleX,scaleY){return this.x*=scaleX,this.y*=scaleY,this},Point.prototype.rotate=function(y){var cos=Math.cos(y),sin=Math.sin(y),y=this.x*sin+this.y*cos;return this.x=this.x*cos-this.y*sin,this.y=y,this},Point.prototype.translateX=function(offsetX){return this.x+=offsetX,this},Point.prototype.translateY=function(offsetY){return this.y+=offsetY,this},Point.prototype.translate=function(offsetX,offsetY){return this.x+=offsetX,this.y+=offsetY,this},Point.prototype.transform=function(matrix){var y=this.x*matrix.getM12()+this.y*matrix.getM22()+matrix.offsetY;return this.x=this.x*matrix.getM11()+this.y*matrix.getM21()+matrix.offsetX,this.y=y,this},Point.prototype.resetTransform=function(matrix){this.x-=matrix.offsetX,this.y-=matrix.offsetY;var y=this.x*matrix.getM12i()+this.y*matrix.getM22i();return this.x=this.x*matrix.getM11i()+this.y*matrix.getM21i(),this.y=y,this},Collision.arc=function(x1,y1,r1,x2,y2,r2){return Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2))<=r1+r2},Collision.rect=function(x1,y1,x2,y2,x3,y3,x4,y4){return x1<=x4&&y1<=y4&&x3<=x2&&y3<=y2},Collision.arcRect=function(x,y,r,x1,y1,minX,minY,cx,cy,cos,sin){var t;return 11===arguments.length&&(t=(cx-x)*sin+(y-cy)*cos+cy,x=(x-cx)*cos+(y-cy)*sin+cx,y=t),minX=x<x1?x1:minX<x?minX:x,minY=y<y1?y1:minY<y?minY:y,Math.sqrt(Math.pow(minX-x,2)+Math.pow(minY-y,2))<=r},Collision.light=function(x,y,a2,ix,x1,y1,x2,b2){if((x-x1)*(y-b2)<(y-y1)*(x-x2))return!1;var a1=ix-y,ix=x-a2,a2=b2-y1,b2=x1-x2,ix=((a1*x+ix*y)*b2-(a2*x1+b2*y1)*ix)/(a1*b2-a2*ix);return x1<=ix&&ix<=x2},Collision.sepAxis=function(points1,points2){for(var tx,ty,i=0;i<points1.length;i+=2)if(tx=points1[i+2],ty=points1[i+3],i+2===points1.length&&(tx=points1[0],ty=points1[1]),projection(points1,points2,ty-points1[i+1],points1[i]-tx))return!1;for(i=0;i<points2.length;i+=2)if(tx=points2[i+2],ty=points2[i+3],i+2===points2.length&&(tx=points2[0],ty=points2[1]),projection(points1,points2,ty-points2[i+1],points2[i]-tx))return!1;return!0;function projection(points1,points2,axisX,axisY){for(var min1,max1,min2,max2,lambda,i=0;i<points1.length;i+=2)lambda=points1[i]*axisX+points1[i+1]*axisY,isNaN(min1)?min1=max1=lambda:lambda<min1?min1=lambda:max1<lambda&&(max1=lambda);for(i=0;i<points2.length;i+=2)lambda=points2[i]*axisX+points2[i+1]*axisY,isNaN(min2)?min2=max2=lambda:lambda<min2?min2=lambda:max2<lambda&&(max2=lambda);return max1<min2||max2<min1}},Collision.sepAxisArc=function(points,x,y,r){for(var tx,ty,minX,minY,i=0;i<points.length;i+=2)if(tx=points[i+2],ty=points[i+3],i+2===points.length&&(tx=points[0],ty=points[1]),projection(points,x,y,r,ty-points[i+1],points[i]-tx))return!1;for(i=0;i<points.length;i+=2)tx=points[i],ty=points[i+1],(isNaN(minX)||Math.pow(tx-x,2)+Math.pow(ty-y,2)<Math.pow(minX-x,2)+Math.pow(minY-y,2))&&(minX=tx,minY=ty);return!projection(points,x,y,r,minX-x,minY-y);function projection(points,x,y,r,axisX,axisY){var min1,max1,lambda,i,modulus=Math.sqrt(Math.pow(axisX,2)+Math.pow(axisY,2));for(axisX/=modulus,axisY/=modulus,i=0;i<points.length;i+=2)lambda=points[i]*axisX+points[i+1]*axisY,isNaN(min1)?min1=max1=lambda:lambda<min1?min1=lambda:max1<lambda&&(max1=lambda);return max1<(lambda=x*axisX+y*axisY)-r||lambda+r<min1}},Config.DEFAULT_GLOBAL_ALPHA=1,Config.DEFAULT_GLOBAL_COMPOSITE_OPERATION="source-over",Config.DEFAULT_FILTER="none",Config.prototype.setGlobalAlpha=function(alpha){var ctx=this.ctx;return ctx.CURRENT_GLOBAL_ALPHA!==alpha&&(ctx.globalAlpha=ctx.CURRENT_GLOBAL_ALPHA=alpha),this},Config.prototype.resetGlobalAlpha=function(){var ctx=this.ctx;return ctx.CURRENT_GLOBAL_ALPHA!==Config.DEFAULT_GLOBAL_ALPHA&&(ctx.globalAlpha=ctx.CURRENT_GLOBAL_ALPHA=Config.DEFAULT_GLOBAL_ALPHA),this},Config.prototype.setGlobalCompositeOperation=function(operation){var ctx=this.ctx;return ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION!==operation&&(ctx.globalCompositeOperation=ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION=operation),this},Config.prototype.resetGlobalCompositeOperation=function(){var ctx=this.ctx;return ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION!==Config.DEFAULT_GLOBAL_COMPOSITE_OPERATION&&(ctx.globalCompositeOperation=ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION=Config.DEFAULT_GLOBAL_COMPOSITE_OPERATION),this},Config.prototype.setFilter=function(filter){var ctx=this.ctx;return ctx.CURRENT_FILTER!==filter&&(ctx.filter=ctx.CURRENT_FILTER=filter),this},Config.prototype.resetFilter=function(){var ctx=this.ctx;return ctx.CURRENT_FILTER!==Config.DEFAULT_FILTER&&(ctx.filter=ctx.CURRENT_FILTER=Config.DEFAULT_FILTER),this},Config.prototype.setShadowStyles=function(style){var ctx=this.ctx;return ctx.CURRENT_SHADOW_BLUR!==style.shadowBlur&&(ctx.shadowBlur=ctx.CURRENT_SHADOW_BLUR=style.shadowBlur),ctx.CURRENT_SHADOW_COLOR!==style.shadowColor&&(ctx.shadowColor=ctx.CURRENT_SHADOW_COLOR=style.shadowColor),ctx.CURRENT_SHADOW_OFFSET_X!==style.shadowOffsetX&&(ctx.shadowOffsetX=ctx.CURRENT_SHADOW_OFFSET_X=style.shadowOffsetX),ctx.CURRENT_SHADOW_OFFSET_Y!==style.shadowOffsetY&&(ctx.shadowOffsetY=ctx.CURRENT_SHADOW_OFFSET_Y=style.shadowOffsetY),this},Config.prototype.resetShadowStyles=function(){var ctx=this.ctx;return ctx.CURRENT_SHADOW_BLUR!==ShadowStyle.DEFAULT_SHADOW_BLUR&&(ctx.shadowBlur=ctx.CURRENT_SHADOW_BLUR=ShadowStyle.DEFAULT_SHADOW_BLUR),ctx.CURRENT_SHADOW_COLOR!==ShadowStyle.DEFAULT_SHADOW_COLOR&&(ctx.shadowColor=ctx.CURRENT_SHADOW_COLOR=ShadowStyle.DEFAULT_SHADOW_COLOR),ctx.CURRENT_SHADOW_OFFSET_X!==ShadowStyle.DEFAULT_SHADOW_OFFSET_X&&(ctx.shadowOffsetX=ctx.CURRENT_SHADOW_OFFSET_X=ShadowStyle.DEFAULT_SHADOW_OFFSET_X),ctx.CURRENT_SHADOW_OFFSET_Y!==ShadowStyle.DEFAULT_SHADOW_OFFSET_Y&&(ctx.shadowOffsetY=ctx.CURRENT_SHADOW_OFFSET_Y=ShadowStyle.DEFAULT_SHADOW_OFFSET_Y),this},Config.prototype.setOtherStyles=function(style){var ctx=this.ctx;return ctx.CURRENT_LINE_CAP!==style.lineCap&&(ctx.lineCap=ctx.CURRENT_LINE_CAP=style.lineCap),ctx.CURRENT_LINE_JOIN!==style.lineJoin&&(ctx.lineJoin=ctx.CURRENT_LINE_JOIN=style.lineJoin),ctx.CURRENT_MITER_LIMIT!==style.miterLimit&&(ctx.miterLimit=ctx.CURRENT_MITER_LIMIT=style.miterLimit),ctx.CURRENT_DIRECTION!==style.direction&&(ctx.direction=ctx.CURRENT_DIRECTION=style.direction),ctx.CURRENT_IMAGE_SMOOTHING_ENABLED!==style.imageSmoothingEnabled&&(ctx.imageSmoothingEnabled=ctx.CURRENT_IMAGE_SMOOTHING_ENABLED=style.imageSmoothingEnabled),ctx.CURRENT_IMAGE_SMOOTHING_QUALITY!==style.imageSmoothingQuality&&(ctx.imageSmoothingQuality=ctx.CURRENT_IMAGE_SMOOTHING_QUALITY=style.imageSmoothingQuality),this},Config.prototype.resetOtherStyles=function(){var ctx=this.ctx;return ctx.CURRENT_LINE_CAP!==OtherStyle.DEFAULT_LINE_CAP&&(ctx.lineCap=ctx.CURRENT_LINE_CAP=OtherStyle.DEFAULT_LINE_CAP),ctx.CURRENT_LINE_JOIN!==OtherStyle.DEFAULT_LINE_JOIN&&(ctx.lineJoin=ctx.CURRENT_LINE_JOIN=OtherStyle.DEFAULT_LINE_JOIN),ctx.CURRENT_MITER_LIMIT!==OtherStyle.DEFAULT_MITER_LIMIT&&(ctx.miterLimit=ctx.CURRENT_MITER_LIMIT=OtherStyle.DEFAULT_MITER_LIMIT),ctx.CURRENT_DIRECTION!==OtherStyle.DEFAULT_DIRECTION&&(ctx.direction=ctx.CURRENT_DIRECTION=OtherStyle.DEFAULT_DIRECTION),ctx.CURRENT_IMAGE_SMOOTHING_ENABLED!==OtherStyle.DEFAULT_IMAGE_SMOOTHING_ENABLED&&(ctx.imageSmoothingEnabled=ctx.CURRENT_IMAGE_SMOOTHING_ENABLED=OtherStyle.DEFAULT_IMAGE_SMOOTHING_ENABLED),ctx.CURRENT_IMAGE_SMOOTHING_QUALITY!==OtherStyle.DEFAULT_IMAGE_SMOOTHING_QUALITY&&(ctx.imageSmoothingQuality=ctx.CURRENT_IMAGE_SMOOTHING_QUALITY=OtherStyle.DEFAULT_IMAGE_SMOOTHING_QUALITY),this},ImgData.getPixelIndex=function(width,x,y){return 4*(x+y*width)},ImgData.getPixelColor=function(imageData,x,index){var data=imageData.data,index=ImgData.getPixelIndex(imageData.width,x,index);return new Rgb(data[index],data[index+1],data[index+2],data[index+3])},ImgData.getAverageColor=function(imageData,x,y,w,h){var width=imageData.width,count=imageData.height,data=imageData.data;isNaN(x)?(x=y=0,w=width,h=count):isNaN(w)?(w=width-x,h=count-y):(width<x+w&&(w=width-x),count<y+h&&(h=count-y));for(var red=0,green=0,blue=0,alpha=0,count=w*h,index=ImgData.getPixelIndex(width,x,y),i=0;i<h;i++){for(var j=0;j<w;j++)red+=data[index],green+=data[index+1],blue+=data[index+2],alpha+=data[index+3],index+=4;index+=4*(width-w)}return new Rgb(Math.round(red/count),Math.round(green/count),Math.round(blue/count),Math.round(alpha/count))},ImgData.setPixelColor=function(imageData,rgb,x,y,w,h){var width=imageData.width,height=imageData.height,data=imageData.data;isNaN(x)?(x=y=0,w=width,h=height):isNaN(w)?(w=width-x,h=height-y):(width<x+w&&(w=width-x),height<y+h&&(h=height-y));for(var index=ImgData.getPixelIndex(width,x,y),i=0;i<h;i++){for(var j=0;j<w;j++)data[index]=rgb.red,data[index+1]=rgb.green,data[index+2]=rgb.blue,data[index+3]=rgb.alpha,index+=4;index+=4*(width-w)}},ImgData.mosaic=function(imageData,t,x,y,w,h){var width=imageData.width,height=imageData.height,data=imageData.data;if(isNaN(x)?(x=y=0,w=width,h=height):isNaN(w)?(w=width-x,h=height-y):(width<x+w&&(w=width-x),height<y+h&&(h=height-y)),1!==t){for(var th=Math.floor(h/t),tw=Math.floor(w/t),xm=w%t,ym=h%t,startIndex=ImgData.getPixelIndex(width,x,y),i=0;i<th;i++){for(var j=0;j<tw;j++)mosaicRect(i,j,t,t);mosaicRect(i,tw,xm,t)}for(j=0;j<tw;j++)mosaicRect(th,j,t,ym);mosaicRect(th,tw,xm,ym)}function mosaicRect(index,count,w,h){for(var l,index=startIndex+(index*width+count)*t*4,red=0,green=0,blue=0,alpha=0,count=w*h,temp=index,k=0;k<h;k++){for(l=0;l<w;l++)red+=data[temp],green+=data[temp+1],blue+=data[temp+2],alpha+=data[temp+3],temp+=4;temp+=4*(width-w)}for(red=Math.round(red/count),green=Math.round(green/count),blue=Math.round(blue/count),alpha=Math.round(alpha/count),temp=index,k=0;k<h;k++){for(l=0;l<w;l++)data[temp]=red,data[temp+1]=green,data[temp+2]=blue,data[temp+3]=alpha,temp+=4;temp+=4*(width-w)}}},ImgData.transparencyDisposal=function(imageData,x,y,w,h,v){var width=imageData.width,height=imageData.height,data=imageData.data;isNaN(x)?(x=y=0,w=width,h=height):isNaN(w)?(w=width-x,h=height-y):(width<x+w&&(w=width-x),height<y+h&&(h=height-y)),v=v||255;for(var index=ImgData.getPixelIndex(width,x,y),i=0;i<h;i++){for(var j=0;j<w;j++)data[index]>=v&&data[index+1]>=v&&data[index+2]>=v&&(data[index+3]=0),index+=4;index+=4*(width-w)}},ImgData.reverseColor=function(imageData){for(var data=imageData.data,length=data.length,i=0;i<length;i+=4)data[i]=255-data[i],data[i+1]=255-data[i+1],data[i+2]=255-data[i+2]},ImgData.greyProcessing=function(imageData){for(var data=imageData.data,length=data.length,i=0;i<length;i+=4){var grey=.299*data[i]+.587*data[i+1]+.114*data[i+2];data[i]=grey,data[i+1]=grey,data[i+2]=grey}},ImgData.blackWhite=function(imgData,rate){for(var data=imgData.data,length=data.length,threshold=rate?254*rate:127,i=0;i<length;i+=4){var average=Math.round((data[i]+data[i+1]+data[i+2])/3);data[i]=data[i+1]=data[i+2]=threshold<average?255:0}},ImgData.reliefFilter=function(imageData){for(var width=imageData.width,height=imageData.height,data=imageData.data,w=width-1,h=height-1,w4=4*width,index=0,i=0;i<h;i++){for(var j=0;j<w;j++)data[index]=2*data[index]-data[index+4]-data[index+w4]+127.5,data[index+1]=2*data[index+1]-data[index+5]-data[index+1+w4]+127.5,data[index+2]=2*data[index+2]-data[index+6]-data[index+2+w4]+127.5,index+=4;index+=4}for(index=ImgData.getPixelIndex(width,w,0),i=0;i<h;i++)data[index]=data[index-4],data[index+1]=data[index-3],data[index+2]=data[index-2],index+=w4;for(index=ImgData.getPixelIndex(width,0,h),j=0;j<width;j++)data[index]=data[index-w4],data[index+1]=data[index+1-w4],data[index+2]=data[index+2-w4],index+=4},ImgData.sunGlassFilter=function(imageData){for(var width=imageData.width,height=imageData.height,data=imageData.data,w=width-1,h=height-1,w4=4*width,index=0,i=0;i<h;i++){for(var j=0;j<w;j++)data[index]=2*data[index]-1.5*data[index+4],data[index+1]=2*data[index+1]-1.5*data[index+5],data[index+2]=2*data[index+2]-1.5*data[index+6],index+=4;index+=4}for(index=ImgData.getPixelIndex(width,w,0),i=0;i<h;i++)data[index]=data[index-4],data[index+1]=data[index-3],data[index+2]=data[index-2],index+=w4;for(index=ImgData.getPixelIndex(width,0,h),j=0;j<width;j++)data[index]=data[index-w4],data[index+1]=data[index+1-w4],data[index+2]=data[index+2-w4],index+=4},Animate.prototype._loop=Utils.noop,Animate.prototype.init=function(){return this._timestart=this._timestamp=this._pausestamp=this._pauserange=0,this},Animate.prototype.start=function(){return this.init().resume(),this},Animate.prototype.pause=function(){return this.isRunning()&&(this.stop()._pausestamp=this._realstamp),this},Animate.prototype.resume=function(){this.isStopped()&&this.inProgress()&&this._resume()},Animate.prototype._resume=Utils.noop,Animate.prototype.stop=function(){return this.isRunning()&&this._stop(),this},Animate.prototype._stop=Utils.noop,Animate.prototype.isRunning=function(){return void 0!==this._requestId},Animate.prototype.isStopped=function(){return void 0===this._requestId},Animate.prototype.inProgress=function(){return this._timestamp<this.duration||0!==this._pausestamp},Utils.inheritPrototype(AnimateITV,Animate),AnimateITV.prototype._loop=function(){var timestamp=this._realstamp=performance.now();if(0===this._timestart&&(this._timestart=timestamp),0!==this._pausestamp)return this._pauserange+=timestamp-this._pausestamp,void(this._pausestamp=0);timestamp-this._pauserange-this._timestart<this.duration?(this.func(this._timestamp),this._timestamp+=this.interval):(this.func(this._timestamp=this.duration),this._stop())},AnimateITV.prototype._resume=function(){this._loop(),this._requestId=setInterval(this._loopBind,this.interval)},AnimateITV.prototype._stop=function(){this._requestId=clearInterval(this._requestId)},Utils.inheritPrototype(AnimateRAF,Animate),AnimateRAF.prototype._loop=function(timestamp){if(this._requestId=requestAnimationFrame(this._loopBind),this._realstamp=timestamp,0===this._timestart&&(this._timestart=timestamp),0!==this._pausestamp)return this._pauserange+=timestamp-this._pausestamp,void(this._pausestamp=0);(timestamp-=this._pauserange+this._timestart)<this.duration?this.interval?timestamp>=this._timestamp&&(this.func(this._timestamp),this._timestamp+=this.interval):this.func(this._timestamp=timestamp):(this.func(this._timestamp=this.duration),this._stop())},AnimateRAF.prototype._resume=function(){this._requestId=requestAnimationFrame(this._loopBind)},AnimateRAF.prototype._stop=function(){this._requestId=cancelAnimationFrame(this._requestId)},BasicShape.prototype.init=function(sx,sy,cx,cy){return this.sx=sx,this.sy=sy,this.cx=cx,this.cy=cy,this._sx=sx-cx,this._sy=sy-cy,this},BasicShape.prototype.initXY=function(sx,sy){return this.sx=sx,this.sy=sy,this._sx=sx-this.cx,this._sy=sy-this.cy,this},BasicShape.prototype.initCXY=function(cx,cy){return this.cx=cx,this.cy=cy,this._sx=this.sx-cx,this._sy=this.sy-cy,this},BasicShape.prototype.fill=function(){return this.setTransform().process(),this.ctx.fill(),this},BasicShape.prototype.fillEvenOdd=function(){return this.setTransform().process(),this.ctx.fill("evenodd"),this},BasicShape.prototype.stroke=function(){return this.setTransform().process(),this.ctx.stroke(),this},BasicShape.prototype.fillStroke=function(){return this.setTransform().process(),this.ctx.fill(),this.ctx.stroke(),this},BasicShape.prototype.fillEvenOddStroke=function(){return this.setTransform().process(),this.ctx.fill("evenodd"),this.ctx.stroke(),this},BasicShape.prototype.clip=function(){return this._save().setTransform().process(),this.ctx.clip(),this},BasicShape.prototype.clipEvenOdd=function(){return this._save().setTransform().process(),this.ctx.clip("evenodd"),this},BasicShape.prototype._save=function(){var ctx=this.ctx;return ctx._m11=ctx.m11,ctx._m12=ctx.m12,ctx._m21=ctx.m21,ctx._m22=ctx.m22,ctx._m41=ctx.m41,ctx._m42=ctx.m42,ctx._m11i=ctx.m11i,ctx._m12i=ctx.m12i,ctx._m21i=ctx.m21i,ctx._m22i=ctx.m22i,ctx._m41i=ctx.m41i,ctx._m42i=ctx.m42i,ctx._CURRENT_GLOBAL_ALPHA=ctx.CURRENT_GLOBAL_ALPHA,ctx._CURRENT_GLOBAL_COMPOSITE_OPERATION=ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION,ctx._CURRENT_FILTER=ctx.CURRENT_FILTER,ctx._CURRENT_FILL_STYLE=ctx.CURRENT_FILL_STYLE,ctx._CURRENT_STROKE_STYLE=ctx.CURRENT_STROKE_STYLE,ctx._CURRENT_FONT=ctx.CURRENT_FONT,ctx._CURRENT_TEXT_ALIGN=ctx.CURRENT_TEXT_ALIGN,ctx._CURRENT_TEXT_BASELINE=ctx.CURRENT_TEXT_BASELINE,ctx._CURRENT_LINE_DASH=ctx.CURRENT_LINE_DASH,ctx._CURRENT_LINE_DASH_OFFSET=ctx.CURRENT_LINE_DASH_OFFSET,ctx._CURRENT_LINE_WIDTH=ctx.CURRENT_LINE_WIDTH,ctx._CURRENT_SHADOW_BLUR=ctx.CURRENT_SHADOW_BLUR,ctx._CURRENT_SHADOW_COLOR=ctx.CURRENT_SHADOW_COLOR,ctx._CURRENT_SHADOW_OFFSET_X=ctx.CURRENT_SHADOW_OFFSET_X,ctx._CURRENT_SHADOW_OFFSET_Y=ctx.CURRENT_SHADOW_OFFSET_Y,ctx._CURRENT_LINE_CAP=ctx.CURRENT_LINE_CAP,ctx._CURRENT_LINE_JOIN=ctx.CURRENT_LINE_JOIN,ctx._CURRENT_MITER_LIMIT=ctx.CURRENT_MITER_LIMIT,ctx._CURRENT_DIRECTION=ctx.CURRENT_DIRECTION,ctx._CURRENT_IMAGE_SMOOTHING_ENABLED=ctx.CURRENT_IMAGE_SMOOTHING_ENABLED,ctx._CURRENT_IMAGE_SMOOTHING_QUALITY=ctx.CURRENT_IMAGE_SMOOTHING_QUALITY,ctx.save(),this},BasicShape.prototype.restore=function(){var ctx=this.ctx;return ctx.m11=ctx._m11,ctx.m12=ctx._m12,ctx.m21=ctx._m21,ctx.m22=ctx._m22,ctx.m41=ctx._m41,ctx.m42=ctx._m42,ctx.m11i=ctx._m11i,ctx.m12i=ctx._m12i,ctx.m21i=ctx._m21i,ctx.m22i=ctx._m22i,ctx.m41i=ctx._m41i,ctx.m42i=ctx._m42i,ctx.CURRENT_GLOBAL_ALPHA=ctx._CURRENT_GLOBAL_ALPHA,ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION=ctx._CURRENT_GLOBAL_COMPOSITE_OPERATION,ctx.CURRENT_FILTER=ctx._CURRENT_FILTER,ctx.CURRENT_FILL_STYLE=ctx._CURRENT_FILL_STYLE,ctx.CURRENT_STROKE_STYLE=ctx._CURRENT_STROKE_STYLE,ctx.CURRENT_FONT=ctx._CURRENT_FONT,ctx.CURRENT_TEXT_ALIGN=ctx._CURRENT_TEXT_ALIGN,ctx.CURRENT_TEXT_BASELINE=ctx._CURRENT_TEXT_BASELINE,ctx.CURRENT_LINE_DASH=ctx._CURRENT_LINE_DASH,ctx.CURRENT_LINE_DASH_OFFSET=ctx._CURRENT_LINE_DASH_OFFSET,ctx.CURRENT_LINE_WIDTH=ctx._CURRENT_LINE_WIDTH,ctx.CURRENT_SHADOW_BLUR=ctx._CURRENT_SHADOW_BLUR,ctx.CURRENT_SHADOW_COLOR=ctx._CURRENT_SHADOW_COLOR,ctx.CURRENT_SHADOW_OFFSET_X=ctx._CURRENT_SHADOW_OFFSET_X,ctx.CURRENT_SHADOW_OFFSET_Y=ctx._CURRENT_SHADOW_OFFSET_Y,ctx.CURRENT_LINE_CAP=ctx._CURRENT_LINE_CAP,ctx.CURRENT_LINE_JOIN=ctx._CURRENT_LINE_JOIN,ctx.CURRENT_MITER_LIMIT=ctx._CURRENT_MITER_LIMIT,ctx.CURRENT_DIRECTION=ctx._CURRENT_DIRECTION,ctx.CURRENT_IMAGE_SMOOTHING_ENABLED=ctx._CURRENT_IMAGE_SMOOTHING_ENABLED,ctx.CURRENT_IMAGE_SMOOTHING_QUALITY=ctx._CURRENT_IMAGE_SMOOTHING_QUALITY,ctx.restore(),this},BasicShape.prototype.clear=function(sx,sy,sw,sh){var ctx=this.ctx;return this.setTransform().process(),ctx.save(),ctx.clip(),ctx.clearRect(this._sx+sx,this._sy+sy,sw,sh),ctx.restore(),this},BasicShape.prototype.clearEvenOdd=function(sx,sy,sw,sh){var ctx=this.ctx;return this.setTransform().process(),ctx.save(),ctx.clip("evenodd"),ctx.clearRect(this._sx+sx,this._sy+sy,sw,sh),ctx.restore(),this},BasicShape.prototype.setTransform=function(){var ctx=this.ctx,mat=this.mat,m11=mat.getM11(),m22=mat.getM22(),m12=mat.getM12(),m21=mat.getM21(),m41=mat.offsetX+this.cx,m42=mat.offsetY+this.cy;return m11!==ctx.m11||m22!==ctx.m22||m12!==ctx.m12||m21!==ctx.m21?(ctx.transform(m11*ctx.m11i+m12*ctx.m21i,m11*ctx.m12i+m12*ctx.m22i,m21*ctx.m11i+m22*ctx.m21i,m21*ctx.m12i+m22*ctx.m22i,m41*ctx.m11i+m42*ctx.m21i+ctx.m41i,m41*ctx.m12i+m42*ctx.m22i+ctx.m42i),ctx.m11=m11,ctx.m12=m12,ctx.m21=m21,ctx.m22=m22,ctx.m41=m41,ctx.m42=m42,ctx.m11i=mat.getM11i(),ctx.m12i=mat.getM12i(),ctx.m21i=mat.getM21i(),ctx.m22i=mat.getM22i(),ctx.m41i=-m41*ctx.m11i-m42*ctx.m21i,ctx.m42i=-m41*ctx.m12i-m42*ctx.m22i):m41===ctx.m41&&m42===ctx.m42||(ctx.translate(m41*ctx.m11i+m42*ctx.m21i+ctx.m41i,m41*ctx.m12i+m42*ctx.m22i+ctx.m42i),ctx.m41=m41,ctx.m42=m42,ctx.m41i=-m41*ctx.m11i-m42*ctx.m21i,ctx.m42i=-m41*ctx.m12i-m42*ctx.m22i),this},BasicShape.prototype.resetTransform=function(){var ctx=this.ctx;return 1!==ctx.m11i||1!==ctx.m22i||0!==ctx.m12i||0!==ctx.m21i?(ctx.transform(ctx.m11i,ctx.m12i,ctx.m21i,ctx.m22i,ctx.m41i,ctx.m42i),ctx.m11=ctx.m11i=ctx.m22=ctx.m22i=1,ctx.m12=ctx.m12i=ctx.m21=ctx.m21i=ctx.m41=ctx.m41i=ctx.m42=ctx.m42i=0):0===ctx.m41i&&0===ctx.m42i||(ctx.translate(ctx.m41i,ctx.m42i),ctx.m41=ctx.m41i=ctx.m42=ctx.m42i=0),this},BasicShape.prototype.process=Utils.noop,BasicShape.prototype.isPointInPath=function(x,y){var ctx=this.ctx,m22=this.mat,m11i=m22.getM11i(),m12i=m22.getM12i(),m21i=m22.getM21i(),m22i=m22.getM22i(),m41i=-(m22.offsetX+this.cx)*m11i-(m22.offsetY+this.cy)*m21i,m42i=-(m22.offsetX+this.cx)*m12i-(m22.offsetY+this.cy)*m22i,m11=ctx.m11,m12=ctx.m12,m21=ctx.m21,m22=ctx.m22;return this.process(),ctx.isPointInPath((m11i*m11+m12i*m21)*x+(m21i*m11+m22i*m21)*y+m41i*m11+m42i*m21+ctx.m41,(m11i*m12+m12i*m22)*x+(m21i*m12+m22i*m22)*y+m41i*m12+m42i*m22+ctx.m42)},BasicShape.prototype.isPointInStroke=function(x,y){var ctx=this.ctx,m22=this.mat,m11i=m22.getM11i(),m12i=m22.getM12i(),m21i=m22.getM21i(),m22i=m22.getM22i(),m41i=-(m22.offsetX+this.cx)*m11i-(m22.offsetY+this.cy)*m21i,m42i=-(m22.offsetX+this.cx)*m12i-(m22.offsetY+this.cy)*m22i,m11=ctx.m11,m12=ctx.m12,m21=ctx.m21,m22=ctx.m22;return this.process(),ctx.isPointInStroke((m11i*m11+m12i*m21)*x+(m21i*m11+m22i*m21)*y+m41i*m11+m42i*m21+ctx.m41,(m11i*m12+m12i*m22)*x+(m21i*m12+m22i*m22)*y+m41i*m12+m42i*m22+ctx.m42)},BasicShape.prototype.getStartX=function(){return this.sx},BasicShape.prototype.setStartX=function(sx){return this.sx=sx,this._sx=sx-this.cx,this},BasicShape.prototype.getStartY=function(){return this.sy},BasicShape.prototype.setStartY=function(sy){return this.sy=sy,this._sy=sy-this.cy,this},BasicShape.prototype.getCenterX=function(){return this.cx},BasicShape.prototype.setCenterX=function(cx){return this.cx=cx,this._sx=this.sx-cx,this},BasicShape.prototype.getCenterY=function(){return this.cy},BasicShape.prototype.setCenterY=function(cy){return this.cy=cy,this._sy=this.sy-cy,this},BasicShape.prototype.getMatrix=function(){return this.mat},BasicShape.prototype.setMatrix=function(mat){return this.mat=mat,this},Utils.inheritPrototype(Shape,BasicShape),Shape.prototype.fill=function(){return this.setStyles().setTransform().process(),this.ctx.fill(),this},Shape.prototype.fillEvenOdd=function(){return this.setStyles().setTransform().process(),this.ctx.fill("evenodd"),this},Shape.prototype.stroke=function(){return this.setStyles().setTransform().process(),this.ctx.stroke(),this},Shape.prototype.fillStroke=function(){return this.setStyles().setTransform().process(),this.ctx.fill(),this.ctx.stroke(),this},Shape.prototype.fillEvenOddStroke=function(){return this.setStyles().setTransform().process(),this.ctx.fill("evenodd"),this.ctx.stroke(),this},Shape.prototype.setStyles=function(){var ctx=this.ctx,sty=this.sty;return ctx.CURRENT_FILL_STYLE!==sty.fillStyle&&(ctx.fillStyle=ctx.CURRENT_FILL_STYLE=sty.fillStyle),ctx.CURRENT_STROKE_STYLE!==sty.strokeStyle&&(ctx.strokeStyle=ctx.CURRENT_STROKE_STYLE=sty.strokeStyle),ctx.CURRENT_LINE_DASH!==sty.lineDash&&(ctx.CURRENT_LINE_DASH=sty.lineDash,ctx.setLineDash(sty.lineDash)),ctx.CURRENT_LINE_DASH_OFFSET!==sty.lineDashOffset&&(ctx.lineDashOffset=ctx.CURRENT_LINE_DASH_OFFSET=sty.lineDashOffset),ctx.CURRENT_LINE_WIDTH!==sty.lineWidth&&(ctx.lineWidth=ctx.CURRENT_LINE_WIDTH=sty.lineWidth),this},Shape.prototype.getStyle=function(){return this.sty},Shape.prototype.setStyle=function(sty){return this.sty=sty,this},Utils.inheritPrototype(Rect,Shape),Rect.prototype.process=function(){this.ctx.beginPath(),this.ctx.rect(this._sx,this._sy,this.sw,this.sh)},Rect.prototype.isPointInPath=function(x,y){var t,mat=this.mat,left=this._sx,right=this._sx+this.sw,top=this._sy,bottom=this._sy+this.sh;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,right<left&&(t=left,left=right,right=t),bottom<top&&(t=top,top=bottom,bottom=t),left<=x&&top<=y&&x<=right&&y<=bottom},Rect.prototype.isPointInStroke=function(x,y){var t,mat=this.mat,lineWidth=this.sty.lineWidth,left=this._sx,right=this._sx+this.sw,top=this._sy,bottom=this._sy+this.sh;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,right<left&&(t=left,left=right,right=t),bottom<top&&(t=top,top=bottom,bottom=t),(0===Math.round((x-left)/lineWidth)||0===Math.round((x-right)/lineWidth))&&top<=y&&y<=bottom||(0===Math.round((y-top)/lineWidth)||0===Math.round((y-bottom)/lineWidth))&&left<=x&&x<=right},Rect.prototype.getWidth=function(){return this.sw},Rect.prototype.setWidth=function(sw){return this.sw=sw,this},Rect.prototype.getHeight=function(){return this.sh},Rect.prototype.setHeight=function(sh){return this.sh=sh,this},Utils.inheritPrototype(RoundRect,Rect),RoundRect.prototype.process=function(){var ctx=this.ctx,sx=this._sx,sy=this._sy,dw=sx+this.sw,dh=sy+this.sh,r=this.r;ctx.beginPath(),ctx.moveTo(sx+r*(0<this.sw?1:-1),sy),ctx.arcTo(dw,sy,dw,dh,r),ctx.arcTo(dw,dh,sx,dh,r),ctx.arcTo(sx,dh,sx,sy,r),ctx.arcTo(sx,sy,dw,sy,r)},RoundRect.prototype.getRadius=function(){return this.r},RoundRect.prototype.setRadius=function(r){return this.r=isNaN(r)?Math.round(Math.min(Math.abs(this.sw),Math.abs(this.sh))/4):r,this},Utils.inheritPrototype(Image,Rect),Image.prototype.draw=Utils.noop,Image.prototype.getSrc=function(){return this.src},Image.prototype.setSrc=function(src){return void 0!==src&&Utils.loadImage(this.src=encodeURI(src),this._setImage,this),this},Image.prototype._setImage=function(image){return-1!==image.src.indexOf(this.src)&&this.setImage(image),this},Image.prototype.getImage=function(){return this.image},Image.prototype.setImage=function(image){return this.image!==image&&(this.image=image,this.src=image.src,this._resetDraw().draw()),this},Image.prototype.isComplete=function(){return void 0!==this.image&&this.image.src===this.src},Image.prototype._resetDraw=function(){return isNaN(this.isx)||isNaN(this.isy)||isNaN(this.isw)||isNaN(this.ish)?this._adjustSize?(this.setWidth(this.image.width).setHeight(this.image.height),this.draw!==Image.prototype._draw0&&(this.draw=Image.prototype._draw0)):this.draw!==Image.prototype._draw2&&(this.draw=Image.prototype._draw2):(this._adjustSize&&this.setWidth(this.isw).setHeight(this.ish),this.draw!==Image.prototype._draw6&&(this.draw=Image.prototype._draw6)),this},Image.prototype._draw0=function(){return this.setTransform(),this.ctx.drawImage(this.image,this._sx,this._sy),this},Image.prototype._draw2=function(){return this.setTransform(),this.ctx.drawImage(this.image,this._sx,this._sy,this.sw,this.sh),this},Image.prototype._draw6=function(){return this.setTransform(),this.ctx.drawImage(this.image,this.isx,this.isy,this.isw,this.ish,this._sx,this._sy,this.sw,this.sh),this},Image.prototype.getAdjustSize=function(){return this._adjustSize},Image.prototype.setAdjustSize=function(adjustSize){return this._adjustSize=adjustSize,this},Image.prototype.getCropX=function(){return this.isx},Image.prototype.setCropX=function(isx){return this.isx=isx,this},Image.prototype.getCropY=function(){return this.isy},Image.prototype.setCropY=function(isy){return this.isy=isy,this},Image.prototype.getCropWidth=function(){return this.isw},Image.prototype.setCropWidth=function(isw){return this.isw=isw,this},Image.prototype.getCropHeight=function(){return this.ish},Image.prototype.setCropHeight=function(ish){return this.ish=ish,this},Utils.inheritPrototype(Arc,Shape),Arc.prototype.process=function(){this.ctx.beginPath(),this.ctx.arc(this._sx,this._sy,this.r,this.startAngle,this.endAngle,this.anticlockwise)},Arc.prototype.isPointInPath=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,Math.sqrt(Math.pow(this._sx-x,2)+Math.pow(this._sy-y,2))<=this.r},Arc.prototype.isPointInStroke=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,0===Math.round((Math.sqrt(Math.pow(this._sx-x,2)+Math.pow(this._sy-y,2))-this.r)/this.sty.lineWidth)},Arc.prototype.getRadius=function(){return this.r},Arc.prototype.setRadius=function(r){return this.r=r,this},Arc.prototype.getStartAngle=function(){return this.startAngle},Arc.prototype.setStartAngle=function(startAngle){return this.startAngle=startAngle,this},Arc.prototype.getEndAngle=function(){return this.endAngle},Arc.prototype.setEndAngle=function(endAngle){return this.endAngle=endAngle,this},Arc.prototype.getAnticlockwise=function(){return this.anticlockwise},Arc.prototype.setAnticlockwise=function(anticlockwise){return this.anticlockwise=anticlockwise,this},Utils.inheritPrototype(Sector,Arc),Sector.prototype.process=function(){var ctx=this.ctx,sx=this._sx,sy=this._sy;ctx.beginPath(),ctx.moveTo(sx,sy),ctx.arc(sx,sy,this.r,this.startAngle,this.endAngle,this.anticlockwise),ctx.lineTo(sx,sy)},Sector.prototype.isPointInPath=Shape.prototype.isPointInPath,Sector.prototype.isPointInStroke=Shape.prototype.isPointInStroke,Utils.inheritPrototype(Ellipse,Arc),Ellipse.prototype.process=function(){this.ctx.beginPath(),this.ctx.ellipse(this._sx,this._sy,this.r,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise)},Ellipse.prototype.isPointInPath=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i()-this._sy,x=x*mat.getM11i()+y*mat.getM21i()-this._sx,y=-this._sin*x+this._cos*t,x=this._cos*x+this._sin*t,Math.sqrt(Math.pow(x,2)*this._ryx+Math.pow(y,2)*this._rxy)<=this._sqrtRxRy},Ellipse.prototype.isPointInStroke=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i()-this._sy,x=x*mat.getM11i()+y*mat.getM21i()-this._sx,y=-this._sin*x+this._cos*t,x=this._cos*x+this._sin*t,0===Math.round((Math.sqrt(Math.pow(x,2)*this._ryx+Math.pow(y,2)*this._rxy)-this._sqrtRxRy)/this.sty.lineWidth)},Ellipse.prototype.getRadiusX=function(){return this.r},Ellipse.prototype.setRadiusX=function(radiusX){return this.r=radiusX,this._sqrtRxRy=Math.sqrt(radiusX*this.radiusY),this._rxy=radiusX/this.radiusY,this._ryx=this.radiusY/radiusX,this},Ellipse.prototype.getRadiusY=function(){return this.radiusY},Ellipse.prototype.setRadiusY=function(radiusY){return this.radiusY=radiusY,this._sqrtRxRy=Math.sqrt(this.r*radiusY),this._rxy=this.r/radiusY,this._ryx=radiusY/this.r,this},Ellipse.prototype.setRadius=function(radiusX,radiusY){return this.r=radiusX,this.radiusY=radiusY,this._sqrtRxRy=Math.sqrt(radiusX*radiusY),this._rxy=radiusX/radiusY,this._ryx=radiusY/radiusX,this},Ellipse.prototype.getRotation=function(){return this.rotation},Ellipse.prototype.setRotation=function(rotation){return this.rotation!==rotation&&(this.rotation=rotation,this._cos=Math.cos(rotation),this._sin=Math.sin(rotation)),this},Utils.inheritPrototype(Line,Shape),Line.prototype.process=function(){var ctx=this.ctx;ctx.beginPath(),ctx.moveTo(this._sx,this._sy),ctx.lineTo(this._ex,this._ey)},Line.prototype.getEndX=function(){return this.ex},Line.prototype.setEndX=function(ex){return this.ex=ex,this._ex=ex-this.cx,this},Line.prototype.getEndY=function(){return this.ey},Line.prototype.setEndY=function(ey){return this.ey=ey,this._ey=ey-this.cy,this},Utils.inheritPrototype(BezierLine,Line),BezierLine.prototype.process=function(){var ctx=this.ctx;ctx.beginPath(),ctx.moveTo(this._sx,this._sy),void 0===this.cp1x?ctx.lineTo(this._ex,this._ey):void 0===this.cp2x?ctx.quadraticCurveTo(this._cp1x,this._cp1y,this._ex,this._ey):ctx.bezierCurveTo(this._cp1x,this._cp1y,this._cp2x,this._cp2y,this._ex,this._ey)},BezierLine.prototype.getControlPoint1X=function(){return this.cp1x},BezierLine.prototype.setControlPoint1X=function(cp1x){return this.cp1x=cp1x,this._cp1x=cp1x-this.cx,this},BezierLine.prototype.getControlPoint1Y=function(){return this.cp1y},BezierLine.prototype.setControlPoint1Y=function(cp1y){return this.cp1y=cp1y,this._cp1y=cp1y-this.cy,this},BezierLine.prototype.getControlPoint2X=function(){return this.cp2x},BezierLine.prototype.setControlPoint2X=function(cp2x){return this.cp2x=cp2x,this._cp2x=cp2x-this.cx,this},BezierLine.prototype.getControlPoint2Y=function(){return this.cp2y},BezierLine.prototype.setControlPoint2Y=function(cp2y){return this.cp2y=cp2y,this._cp2y=cp2y-this.cy,this},Utils.inheritPrototype(Edge,Line),Edge.prototype.process=function(){var oy,r,endAngle,ctx=this.ctx,ox=this._sx,sy=this._sy,ex=this._ex,ey=this._ey,cx=(ox+ex)/2,cy=(sy+ey)/2,startAngle=ex-ox,ty=ey-sy,anti=(this._ax||ex+startAngle)-ex,angle=(this._ay||ey+ty)-ey,centerAngleDouble=Math.sqrt(startAngle*startAngle+ty*ty),lambda=this._lambda=this.el/centerAngleDouble/2,pclx=startAngle*lambda,pcly=ty*lambda;this._lineAngle=Math.atan2(ty,startAngle),ctx.beginPath(),ctx.moveTo(ox,sy),startAngle*angle!=ty*anti&&lambda<.5?(this._angle=Math.atan2(angle,anti),angle=ox-(ox=((r=-anti*ex-angle*ey)*ty-(oy=-startAngle*cx-ty*cy)*angle)/(endAngle=startAngle*angle-anti*ty)),anti=sy-(oy=(oy*anti-r*startAngle)/endAngle),endAngle=ty/centerAngleDouble*(r=Math.sqrt(angle*angle+anti*anti)),ty=-startAngle/centerAngleDouble*r,startAngle=Math.atan2(anti,angle),centerAngleDouble=2*this._lineAngle-Math.PI,anti=!1,((angle=this._angle-this._lineAngle)>Math.PI||angle<0&&angle>-Math.PI)&&(endAngle*=-1,ty*=-1,centerAngleDouble+=2*Math.PI,anti=!0),this._tx=endAngle+ox,this._ty=ty+oy,0==lambda?ctx.arc(ox,oy,r,startAngle,centerAngleDouble-startAngle,anti):(endAngle=Math.atan2(ty-pcly,endAngle-pclx),ctx.arc(ox,oy,r,startAngle,endAngle,anti),ctx.moveTo(ex,ey),ctx.arc(ox,oy,r,centerAngleDouble-startAngle,centerAngleDouble-endAngle,!anti))):(this._angle=this._lineAngle,this._tx=cx,this._ty=cy,0==lambda||.5<=lambda||(ctx.lineTo(cx-pclx,cy-pcly),ctx.moveTo(cx+pclx,cy+pcly)),ctx.lineTo(ex,ey))},Edge.prototype.getAngleX=function(){return this.ax},Edge.prototype.setAngleX=function(ax){return this.ax=ax,this._ax=ax-this.cx,this},Edge.prototype.getAngleY=function(){return this.ay},Edge.prototype.setAngleY=function(ay){return this.ay=ay,this._ay=ay-this.cy,this},Edge.prototype.getEmptyLength=function(){return this.el},Edge.prototype.setEmptyLength=function(el){return this.el=el,this},Edge.prototype.getTargetX=function(){return this._tx},Edge.prototype.getTargetY=function(){return this._ty},Edge.prototype.getAngle=function(){return this._angle},Edge.prototype.getLineAngle=function(){return this._lineAngle},Edge.prototype.lambdaInRange=function(){return this._lambda<.5},Utils.inheritPrototype(ArrowHead,Shape),ArrowHead.prototype.process=function(){var ctx=this.ctx,x0=this._sx-this.al*this._cos,y0=this._sy-this.al*this._sin,ox=this.al*this._tan*this._sin,oy=this.al*this._tan*this._cos,x1=x0+ox,y1=y0-oy;ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(this._sx,this._sy),ctx.lineTo(x0-ox,y0+oy),this.closed&&ctx.lineTo(x1,y1)},ArrowHead.prototype.getAngle=function(){return this.an},ArrowHead.prototype.setAngle=function(an){return this.an!==an&&(this.an=an,this._cos=Math.cos(an),this._sin=Math.sin(an)),this},ArrowHead.prototype.getClosed=function(){return this.closed},ArrowHead.prototype.setClosed=function(closed){return this.closed=closed,this},ArrowHead.prototype.getArrowLength=function(){return this.al},ArrowHead.prototype.setArrowLength=function(al){return this.al=al,this},ArrowHead.prototype.getArrowAngle=function(){return this.aa},ArrowHead.prototype.setArrowAngle=function(aa){return this.aa!==aa&&(this.aa=aa,this._tan=Math.tan(aa)),this},Utils.inheritPrototype(Arrow,ArrowHead),Arrow.prototype.process=function(){var ctx=this.ctx,sx=this._sx,tx=this._sy,ex=this._ex,ey=this._ey,cx=(sx+ex)/2,cy=(tx+ey)/2,psex=sx-ex,cpy=tx-ey,c2=this._lambda=this.el/Math.sqrt(psex*psex+cpy*cpy)/2,pclx=psex*c2,pcly=cpy*c2,ax=this._ax||sx+psex,c1=this._ay||tx+cpy,cpx=ax-sx,pasy=c1-tx,_angle=Math.atan2(pasy,cpx),ty=_angle-(this._lineAngle=Math.atan2(cpy,psex)),ty=.5<=c2||ty>=3*-Math.PI/2&&ty<=-Math.PI/2||ty>=Math.PI/2&&ty<=3*Math.PI/2;this.setAngle(ty?this._lineAngle:_angle),ArrowHead.prototype.process.call(this),ctx.moveTo(sx,tx),ty?(this._tx=cx,this._ty=cy,0==c2||.5<=c2||(ctx.lineTo(cx+pclx,cy+pcly),ctx.moveTo(cx-pclx,cy-pcly)),ctx.lineTo(ex,ey)):(cpx=((c2=-psex*(tx=psex*(.809+.382*c2)+ex)-cpy*(ty=cpy*(.809+.382*c2)+ey))*cpx-(c1=pasy*ax-cpx*c1)*cpy)/(cpy=-pasy*cpy-psex*cpx),cpy=(c1*psex+c2*pasy)/cpy,tx=this._tx=cx+cpx-tx,ty=this._ty=cy+cpy-ty,ctx.quadraticCurveTo(cpx,cpy,tx+pclx,ty+pcly),ctx.moveTo(tx-pclx,ty-pcly),ctx.quadraticCurveTo(tx+tx-cpx,ty+ty-cpy,ex,ey))},Arrow.prototype.getEndX=function(){return this.ex},Arrow.prototype.setEndX=function(ex){return this.ex=ex,this._ex=ex-this.cx,this},Arrow.prototype.getEndY=function(){return this.ey},Arrow.prototype.setEndY=function(ey){return this.ey=ey,this._ey=ey-this.cy,this},Arrow.prototype.getAngleX=function(){return this.ax},Arrow.prototype.setAngleX=function(ax){return this.ax=ax,this._ax=ax-this.cx,this},Arrow.prototype.getAngleY=function(){return this.ay},Arrow.prototype.setAngleY=function(ay){return this.ay=ay,this._ay=ay-this.cy,this},Arrow.prototype.getEmptyLength=function(){return this.el},Arrow.prototype.setEmptyLength=function(el){return this.el=el,this},Arrow.prototype.getTargetX=function(){return this._tx},Arrow.prototype.getTargetY=function(){return this._ty},Arrow.prototype.getLineAngle=function(){return this._lineAngle},Arrow.prototype.lambdaInRange=function(){return this._lambda<.5},Utils.inheritPrototype(RegularPolygon,Shape),RegularPolygon.prototype.process=function(){var tempY,ctx=this.ctx,sx=this._sx,sy=this._sy,cos=this._cos,sin=this._sin,cursorX=sx,cursorY=sy-this.r;ctx.beginPath(),ctx.moveTo(cursorX,cursorY);for(var i=0;i<this.sides-1;i++)tempY=(cursorX-sx)*sin+(cursorY-sy)*cos+sy,cursorX=(cursorX-sx)*cos-(cursorY-sy)*sin+sx,cursorY=tempY,ctx.lineTo(cursorX,cursorY);ctx.lineTo(sx,sy-this.r)},RegularPolygon.prototype.getRadius=function(){return this.r},RegularPolygon.prototype.setRadius=function(r){return this.r=r,this},RegularPolygon.prototype.getSides=function(){return this.sides},RegularPolygon.prototype.setSides=function(sides){return this.sides!==sides&&(this.sides=sides,this._cos=Math.cos(2*Math.PI/sides),this._sin=Math.sin(2*Math.PI/sides)),this},Utils.inheritPrototype(RegularStar,RegularPolygon),RegularStar.prototype.process=function(){var tempY,i,ctx=this.ctx,sx=this._sx,sy=this._sy,cursorX=sx,cursorY=sy-this.r,cos=this._cos,sin=this._sin;if(ctx.beginPath(),ctx.moveTo(cursorX,cursorY),this._even){for(i=0;i<this.sides/2-1;i++)lineToNext();ctx.lineTo(sx,sy-this.r);var tmpX=(cursorX-sx)*this._cosh-(cursorY-sy)*this._sinh+sx,tmpY=(cursorX-sx)*this._sinh+(cursorY-sy)*this._cosh+sy,cursorX=tmpX,cursorY=tmpY;for(ctx.moveTo(cursorX,cursorY),i=0;i<this.sides/2-1;i++)lineToNext();ctx.lineTo(tmpX,tmpY)}else{for(i=0;i<this.sides-1;i++)lineToNext();ctx.lineTo(sx,sy-this.r)}function lineToNext(){tempY=(cursorX-sx)*sin+(cursorY-sy)*cos+sy,cursorX=(cursorX-sx)*cos-(cursorY-sy)*sin+sx,cursorY=tempY,ctx.lineTo(cursorX,cursorY)}},RegularStar.prototype.setSides=function(sides){return this.sides!==sides&&(this.sides=sides,this._cos=Math.cos(4*Math.PI/sides),this._sin=Math.sin(4*Math.PI/sides),(this._even=sides%2==0)&&(this._cosh=Math.cos(2*Math.PI/sides),this._sinh=Math.sin(2*Math.PI/sides))),this},Utils.inheritPrototype(Text,BasicShape),Text.prototype.fill=function(){return this.setStyles().setTransform(),this.ctx.fillText(this.text,this._sx,this._sy),this},Text.prototype.stroke=function(){return this.setStyles().setTransform(),this.ctx.strokeText(this.text,this._sx,this._sy),this},Text.prototype.fillStroke=function(){return this.setStyles().setTransform(),this.ctx.fillText(this.text,this._sx,this._sy),this.ctx.strokeText(this.text,this._sx,this._sy),this},Text.prototype.setStyles=function(){var ctx=this.ctx,sty=this.sty;return ctx.CURRENT_FILL_STYLE!==sty.fillStyle&&(ctx.fillStyle=ctx.CURRENT_FILL_STYLE=sty.fillStyle),ctx.CURRENT_STROKE_STYLE!==sty.strokeStyle&&(ctx.strokeStyle=ctx.CURRENT_STROKE_STYLE=sty.strokeStyle),ctx.CURRENT_FONT!==sty.font&&(ctx.font=ctx.CURRENT_FONT=sty.font),ctx.CURRENT_TEXT_ALIGN!==sty.textAlign&&(ctx.textAlign=ctx.CURRENT_TEXT_ALIGN=sty.textAlign),ctx.CURRENT_TEXT_BASELINE!==sty.textBaseline&&(ctx.textBaseline=ctx.CURRENT_TEXT_BASELINE=sty.textBaseline),this},Text.prototype.getText=function(){return this.text},Text.prototype.setText=function(text){return this.text=text,this},Text.prototype.getStyle=function(){return this.sty},Text.prototype.setStyle=function(sty){return this.sty=sty,this},Utils.inheritPrototype(DotShape,Shape),DotShape.prototype._initDataPoints=function(){return this._processedPoints=[],this._transformedPoints=[],this},DotShape.prototype._initCache=function(){var cache=new Map;return cache.set("matrix",new Matrix),cache.set("points",new Array(this.points.length)),cache.set("length",NaN),cache.set("_sx",NaN),cache.set("_sy",NaN),cache.set("cx",NaN),cache.set("cy",NaN),this.cache=cache,this},DotShape.prototype._useCache=function(){var i,p,cache=this.cache,cmatrix=cache.get("matrix"),mat=this.mat,cpoints=cache.get("points"),points=this.points,length=this.length,matrixChanged=!1,pointsChanged=!1,lengthChanged=!1,sxyChanged=!1,cxyChanged=!1;for(cmatrix.equals(mat)||(cmatrix.skewX=mat.skewX,cmatrix.skewY=mat.skewY,cmatrix.scaleX=mat.scaleX,cmatrix.scaleY=mat.scaleY,cmatrix.angle=mat.angle,cmatrix.offsetX=mat.offsetX,cmatrix.offsetY=mat.offsetY,matrixChanged=!0),i=0;i<points.length;i++)p=points[i],cpoints[i]!==p&&(cpoints[i]=p,pointsChanged=!0);return cpoints.length>points.length&&(cpoints.length=points.length,pointsChanged=!0),cache.get("length")!==length&&(cache.set("length",length),this._processedPoints.length=length,this._transformedPoints.length=length,lengthChanged=!0),cache.get("_sx")===this._sx&&cache.get("_sy")===this._sy||(cache.set("_sx",this._sx),cache.set("_sy",this._sy),sxyChanged=!0),(pointsChanged||lengthChanged||sxyChanged)&&this._processPoints(),cache.get("cx")===this.cx&&cache.get("cy")===this.cy||(cache.set("cx",this.cx),cache.set("cy",this.cy),cxyChanged=!0),!(matrixChanged||pointsChanged||lengthChanged||sxyChanged||cxyChanged)},DotShape.prototype.clear=function(sx,sy,sw,sh){var ctx=this.ctx;return this.setTransform().process(),ctx.save(),ctx.clip(),ctx.clearRect(this._transformedPoints[0]+sx,this._transformedPoints[1]+sy,sw,sh),ctx.restore(),this},DotShape.prototype.clearEvenOdd=function(sx,sy,sw,sh){var ctx=this.ctx;return this.setTransform().process(),ctx.save(),ctx.clip("evenodd"),ctx.clearRect(this._transformedPoints[0]+sx,this._transformedPoints[1]+sy,sw,sh),ctx.restore(),this},DotShape.prototype.setTransform=function(){if(this.resetTransform()._useCache())return this;var i,x,y,mat=this.mat,processedPoints=this._processedPoints,transformedPoints=this._transformedPoints,m11=mat.getM11(),m12=mat.getM12(),m21=mat.getM21(),m22=mat.getM22(),m41=mat.offsetX+this.cx,m42=mat.offsetY+this.cy;if(1!==m11||1!==m22||0!==m12||0!==m21)for(i=0;i<this.length;i+=2)x=processedPoints[i],y=processedPoints[i+1],transformedPoints[i]=x*m11+y*m21+m41,transformedPoints[i+1]=x*m12+y*m22+m42;else if(0!==m41||0!==m42)for(i=0;i<this.length;i+=2)transformedPoints[i]=processedPoints[i]+m41,transformedPoints[i+1]=processedPoints[i+1]+m42;else for(i=0;i<this.length;i+=2)transformedPoints[i]=processedPoints[i],transformedPoints[i+1]=processedPoints[i+1];return this},DotShape.prototype.isPointInPath=function(x,y){return this.setTransform().process(),this.ctx.isPointInPath(x,y)},DotShape.prototype.isPointInStroke=function(x,y){return this.setTransform().process(),this.ctx.isPointInStroke(x,y)},DotShape.prototype._processPoints=function(){for(var sx=this._sx,sy=this._sy,points=this.points,processedPoints=this._processedPoints,i=0;i<this.length;i+=2)processedPoints[i]=sx+points[i],processedPoints[i+1]=sy+points[i+1];return this},DotShape.prototype.getProcessedPoints=function(){return this._processedPoints},DotShape.prototype.getTransformedPoints=function(){return this._transformedPoints},DotShape.prototype.getPoints=function(){return this.points},DotShape.prototype.setPoints=function(points){return this.points=points,this.length=points.length,this},DotShape.prototype.getLength=function(){return this.length},DotShape.prototype.setLength=function(length){return this.length=0<length?length:0,this},DotShape.prototype.insert=function(x,y){return this.points.push(x,y),this.length+=2,this},DotShape.prototype.insertAt=function(x,y,index){return this.points.splice(2*index,0,x,y),this.length+=2,this},DotShape.prototype.delete=function(index){return this.points.splice(2*index,2),this.length-=2,this},DotShape.prototype.update=function(x,y,index){return index*=2,this.points[index]=x,this.points[index+1]=y,this},DotShape.prototype.select=function(index){return index*=2,new Point(this.points[index],this.points[index+1])},DotShape.prototype.selectAll=function(){for(var points=this.points,all=new Array(points.length/2),i=0;i<points.length;i+=2)all[i/2]=new Point(points[i],points[i+1]);return all},Utils.inheritPrototype(Polyline,DotShape),Polyline.prototype.process=function(){var ctx=this.ctx,transformedPoints=this._transformedPoints;ctx.beginPath();for(var i=0;i<this.length;i+=2)0!==i?ctx.lineTo(transformedPoints[i],transformedPoints[i+1]):ctx.moveTo(transformedPoints[i],transformedPoints[i+1])},Utils.inheritPrototype(Bezier,Polyline),Bezier.prototype._processPoints=function(){for(var j,x,y,v,t,sx=this._sx,sy=this._sy,points=this.points,length=this.length,processedPoints=this._processedPoints,m=points.length/2-1,i=0;i<length;i+=2){for(t=i/(length-2),j=y=x=0;j<points.length;j+=2)v=Utils.combination(v=j/2,m)*Math.pow(t,v)*Math.pow(1-t,m-v),x+=points[j]*v,y+=points[j+1]*v;processedPoints[i]=sx+x,processedPoints[i+1]=sy+y}return this},Bezier.prototype.setPoints=function(points){return this.points=points,this},Bezier.prototype.insert=function(x,y){return this.points.push(x,y),this},Bezier.prototype.insertAt=function(x,y,index){return this.points.splice(2*index,0,x,y),this},Bezier.prototype.delete=function(index){return this.points.splice(2*index,2),this},Utils.inheritPrototype(Polygon,DotShape),Polygon.prototype.process=function(){var ctx=this.ctx,transformedPoints=this._transformedPoints;ctx.beginPath();for(var i=0;i<this.length;i+=2)0===i&&ctx.moveTo(transformedPoints[this.length-2],transformedPoints[this.length-1]),ctx.lineTo(transformedPoints[i],transformedPoints[i+1])},Utils.inheritPrototype(PolyRect,Polygon),PolyRect.prototype._processPoints=function(){var y2=this.points,processedPoints=this._processedPoints,x1=this._sx+y2[0],y1=this._sy+y2[1],x2=this._sx+y2[2],y2=this._sy+y2[3];return processedPoints[0]=processedPoints[6]=x1,processedPoints[1]=processedPoints[3]=y1,processedPoints[2]=processedPoints[4]=x2,processedPoints[5]=processedPoints[7]=y2,x1<x2?(this._left=x1,this._right=x2):(this._left=x2,this._right=x1),y1<y2?(this._top=y1,this._bottom=y2):(this._top=y2,this._bottom=y1),this},PolyRect.prototype.isPointInPath=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,x>=this._left&&y>=this._top&&x<=this._right&&y<=this._bottom},PolyRect.prototype.isPointInStroke=function(x,y){var t,mat=this.mat,lineWidth=this.sty.lineWidth;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,(0===Math.round((x-this._left)/lineWidth)||0===Math.round((x-this._right)/lineWidth))&&y>=this._top&&y<=this._bottom||(0===Math.round((y-this._top)/lineWidth)||0===Math.round((y-this._bottom)/lineWidth))&&x>=this._left&&x<=this._right},PolyRect.prototype.setPoints=function(points){return this.points=points,this},Utils.inheritPrototype(PolyArc,Polygon),PolyArc.prototype._processPoints=function(){var t,i,points=this.points,processedPoints=this._processedPoints,cos=Math.cos(4*Math.PI/this.length),sin=Math.sin(4*Math.PI/this.length),x=points[0],y=points[1],cursorX=points[2]-x,cursorY=points[3]-y;for(this._x=x+=this._sx,this._y=y+=this._sy,this._r=Math.sqrt(Math.pow(cursorX,2)+Math.pow(cursorY,2)),i=0;i<this.length;i+=2)processedPoints[i]=x+cursorX,processedPoints[i+1]=y+cursorY,t=cursorY*cos+cursorX*sin,cursorX=cursorX*cos-cursorY*sin,cursorY=t;return this},PolyArc.prototype.isPointInPath=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,Math.sqrt(Math.pow(this._x-x,2)+Math.pow(this._y-y,2))<=this._r},PolyArc.prototype.isPointInStroke=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,0===Math.round((Math.sqrt(Math.pow(this._x-x,2)+Math.pow(this._y-y,2))-this._r)/this.sty.lineWidth)},PolyArc.prototype.setPoints=function(points){return this.points=points,this},Utils.inheritPrototype(SmoothLine,DotShape),SmoothLine.prototype._processPoints=function(){for(var o2x,o2y,cx,cy,nx,index,sx=this._sx,sy=this._sy,points=this.points,processedPoints=this._processedPoints,o1x=0,o1y=0,px=processedPoints[0]=sx+points[0],py=processedPoints[1]=sy+points[1],i=2;i<points.length;i+=2)cx=sx+points[i],cy=sy+points[i+1],nx=sx+points[i+2],index=sy+points[i+3],isNaN(nx)?o2x=o2y=0:(o2x=(nx-px)/8,o2y=(index-py)/8),processedPoints[index=3*i-4]=px+o1x,processedPoints[1+index]=py+o1y,processedPoints[2+index]=cx-o2x,processedPoints[3+index]=cy-o2y,o1x=o2x,o1y=o2y,px=processedPoints[4+index]=cx,py=processedPoints[5+index]=cy},SmoothLine.prototype.process=function(){var ctx=this.ctx,transformedPoints=this._transformedPoints;ctx.beginPath(),ctx.moveTo(transformedPoints[0],transformedPoints[1]);for(var i=2;i<this.length;i+=6)ctx.bezierCurveTo(transformedPoints[i],transformedPoints[i+1],transformedPoints[i+2],transformedPoints[i+3],transformedPoints[i+4],transformedPoints[i+5])},SmoothLine.prototype.setPoints=function(points){return this.points=points,this.setLength(3*points.length-4),this},SmoothLine.prototype.insert=function(x,y){return this.points.push(x,y),0!==this.length?this.length+=6:this.length=2,this},SmoothLine.prototype.insertAt=function(x,y,index){return this.points.splice(2*index,0,x,y),0!==this.length?this.length+=6:this.length=2,this},SmoothLine.prototype.delete=function(index){return this.points.splice(2*index,2),2<this.length?this.length-=6:this.length=0,this},Utils.inheritPrototype(Dots,DotShape),Dots.prototype.process=function(){var i,x,y,ctx=this.ctx,r=this.r,transformedPoints=this._transformedPoints;for(ctx.beginPath(),i=0;i<this.length;i+=2)x=transformedPoints[i],y=transformedPoints[i+1],ctx.moveTo(x+r,y),ctx.arc(x,y,r,0,2*Math.PI,!1)},Dots.prototype.getRadius=function(){return this.r},Dots.prototype.setRadius=function(r){return this.r=r,this},Utils.inheritPrototype(FixedShape,Shape),FixedShape.prototype.fill=function(){return this.setStyles().setTransform(),this.ctx.fill(this.path),this},FixedShape.prototype.fillEvenOdd=function(){return this.setStyles().setTransform(),this.ctx.fill(this.path,"evenodd"),this},FixedShape.prototype.stroke=function(){return this.setStyles().setTransform(),this.ctx.stroke(this.path),this},FixedShape.prototype.fillStroke=function(){return this.setStyles().setTransform(),this.ctx.fill(this.path),this.ctx.stroke(this.path),this},FixedShape.prototype.fillEvenOddStroke=function(){return this.setStyles().setTransform(),this.ctx.fill(this.path,"evenodd"),this.ctx.stroke(this.path),this},FixedShape.prototype.clip=function(){return this._save().setTransform(),this.ctx.clip(this.path),this},FixedShape.prototype.clipEvenOdd=function(){return this._save().setTransform(),this.ctx.clip(this.path,"evenodd"),this},FixedShape.prototype.clear=function(sx,sy,sw,sh){var ctx=this.ctx;return this.setTransform(),ctx.save(),ctx.clip(this.path),ctx.clearRect(this._sx+sx,this._sy+sy,sw,sh),ctx.restore(),this},FixedShape.prototype.clearEvenOdd=function(sx,sy,sw,sh){var ctx=this.ctx;return this.setTransform(),ctx.save(),ctx.clip(this.path,"evenodd"),ctx.clearRect(this._sx+sx,this._sy+sy,sw,sh),ctx.restore(),this},FixedShape.prototype.isPointInPath=function(x,y){var ctx=this.ctx,m22=this.mat,m11i=m22.getM11i(),m12i=m22.getM12i(),m21i=m22.getM21i(),m22i=m22.getM22i(),m41i=-(m22.offsetX+this.cx)*m11i-(m22.offsetY+this.cy)*m21i,m42i=-(m22.offsetX+this.cx)*m12i-(m22.offsetY+this.cy)*m22i,m11=ctx.m11,m12=ctx.m12,m21=ctx.m21,m22=ctx.m22;return ctx.isPointInPath(this.path,(m11i*m11+m12i*m21)*x+(m21i*m11+m22i*m21)*y+m41i*m11+m42i*m21+ctx.m41,(m11i*m12+m12i*m22)*x+(m21i*m12+m22i*m22)*y+m41i*m12+m42i*m22+ctx.m42)},FixedShape.prototype.isPointInStroke=function(x,y){var ctx=this.ctx,m22=this.mat,m11i=m22.getM11i(),m12i=m22.getM12i(),m21i=m22.getM21i(),m22i=m22.getM22i(),m41i=-(m22.offsetX+this.cx)*m11i-(m22.offsetY+this.cy)*m21i,m42i=-(m22.offsetX+this.cx)*m12i-(m22.offsetY+this.cy)*m22i,m11=ctx.m11,m12=ctx.m12,m21=ctx.m21,m22=ctx.m22;return ctx.isPointInStroke(this.path,(m11i*m11+m12i*m21)*x+(m21i*m11+m22i*m21)*y+m41i*m11+m42i*m21+ctx.m41,(m11i*m12+m12i*m22)*x+(m21i*m12+m22i*m22)*y+m41i*m12+m42i*m22+ctx.m42)},FixedShape.prototype.getPath=function(){var path=new Path2D;return path.addPath(this.path,{e:-this._sx,f:-this._sy}),path},FixedShape.prototype.getOffsetPath=function(){return this.path},FixedShape.prototype.setPath=function(path){return this.path=new Path2D,this.addPath(path),this},FixedShape.prototype.addPath=function(path){var type=Utils._toString.call(path);return"[object String]"===type?this.path.addPath(new Path2D(path),{e:this._sx,f:this._sy}):"[object Path2D]"===type&&this.path.addPath(path,{e:this._sx,f:this._sy}),this},FixedShape.prototype.addFixedShape=function(fixedShape){var matrix=fixedShape.getMatrix();return this.path.addPath(fixedShape.getOffsetPath(),{a:matrix.getM11(),b:matrix.getM12(),c:matrix.getM21(),d:matrix.getM22(),e:matrix.offsetX+fixedShape.cx+this._sx,f:matrix.offsetY+fixedShape.cy+this._sy}),this},Utils.inheritPrototype(FixedRect,FixedShape),FixedRect.prototype.process=function(){this.path.rect(this._sx,this._sy,this.sw,this.sh),0<this.sw?(this._left=this._sx,this._right=this._sx+this.sw):(this._left=this._sx+this.sw,this._right=this._sx),0<this.sh?(this._top=this._sy,this._bottom=this._sy+this.sh):(this._top=this._sy+this.sh,this._bottom=this._sy)},FixedRect.prototype.isPointInPath=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,x>=this._left&&y>=this._top&&x<=this._right&&y<=this._bottom},FixedRect.prototype.isPointInStroke=function(x,y){var t,mat=this.mat,lineWidth=this.sty.lineWidth;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,(0===Math.round((x-this._left)/lineWidth)||0===Math.round((x-this._right)/lineWidth))&&y>=this._top&&y<=this._bottom||(0===Math.round((y-this._top)/lineWidth)||0===Math.round((y-this._bottom)/lineWidth))&&x>=this._left&&x<=this._right},FixedRect.prototype.getWidth=function(){return this.sw},FixedRect.prototype.getHeight=function(){return this.sh},Utils.inheritPrototype(FixedArc,FixedShape),FixedArc.prototype.process=function(){this.path.arc(this._sx,this._sy,this.r,this.startAngle,this.endAngle,this.anticlockwise)},FixedArc.prototype.isPointInPath=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,Math.sqrt(Math.pow(this._sx-x,2)+Math.pow(this._sy-y,2))<=this.r},FixedArc.prototype.isPointInStroke=function(x,y){var t,mat=this.mat;return x-=mat.offsetX+this.cx,y-=mat.offsetY+this.cy,t=x*mat.getM12i()+y*mat.getM22i(),x=x*mat.getM11i()+y*mat.getM21i(),y=t,0===Math.round((Math.sqrt(Math.pow(this._sx-x,2)+Math.pow(this._sy-y,2))-this.r)/this.sty.lineWidth)},FixedArc.prototype.getRadius=function(){return this.r},FixedArc.prototype.getStartAngle=function(){return this.startAngle},FixedArc.prototype.getEndAngle=function(){return this.endAngle},FixedArc.prototype.getAnticlockwise=function(){return this.anticlockwise},Canvas.prototype.merge=function(object){var key,value;for(key in object)this[key]=value=object[key],"[object Object]"===Utils._toString.call(value)&&(value.$ctx=this.$ctx,value.$cfg=this.$cfg);return this},Canvas.prototype._resize=function(){var $=this,rect=$.$wrapper.getBoundingClientRect(),ox=rect.left%1,oy=rect.top%1,sty=$.$canvas.style,ctx=$.$ctx,dpr=devicePixelRatio||1;return $.$canvas.width=($.$width=Math.round(rect.right-rect.left))*dpr,$.$canvas.height=($.$height=Math.round(rect.bottom-rect.top))*dpr,sty.left=(ox<.5?-ox:1-ox)+"px",sty.top=(oy<.5?-oy:1-oy)+"px",sty.width=$.$width+"px",sty.height=$.$height+"px",1!==dpr&&ctx.scale(dpr,dpr),ctx.m11=ctx.m11i=ctx.m22=ctx.m22i=1,ctx.m12=ctx.m12i=ctx.m21=ctx.m21i=ctx.m41=ctx.m41i=ctx.m42=ctx.m42i=0,$._initCurrentStyles(),$},Canvas.prototype._initCurrentStyles=function(){var ctx=this.$ctx;return ctx.CURRENT_GLOBAL_ALPHA=Config.DEFAULT_GLOBAL_ALPHA,ctx.CURRENT_GLOBAL_COMPOSITE_OPERATION=Config.DEFAULT_GLOBAL_COMPOSITE_OPERATION,ctx.CURRENT_FILTER=Config.DEFAULT_FILTER,ctx.CURRENT_FILL_STYLE=FillStrokeStyle.DEFAULT_FILL_STYLE,ctx.CURRENT_STROKE_STYLE=FillStrokeStyle.DEFAULT_STROKE_STYLE,ctx.CURRENT_FONT=TextStyle.DEFAULT_FONT,ctx.CURRENT_TEXT_ALIGN=TextStyle.DEFAULT_TEXT_ALIGN,ctx.CURRENT_TEXT_BASELINE=TextStyle.DEFAULT_TEXT_BASELINE,ctx.CURRENT_LINE_DASH=ShapeStyle.DEFAULT_LINE_DASH,ctx.CURRENT_LINE_DASH_OFFSET=ShapeStyle.DEFAULT_LINE_DASH_OFFSET,ctx.CURRENT_LINE_WIDTH=ShapeStyle.DEFAULT_LINE_WIDTH,ctx.CURRENT_SHADOW_BLUR=ShadowStyle.DEFAULT_SHADOW_BLUR,ctx.CURRENT_SHADOW_COLOR=ShadowStyle.DEFAULT_SHADOW_COLOR,ctx.CURRENT_SHADOW_OFFSET_X=ShadowStyle.DEFAULT_SHADOW_OFFSET_X,ctx.CURRENT_SHADOW_OFFSET_Y=ShadowStyle.DEFAULT_SHADOW_OFFSET_Y,ctx.CURRENT_LINE_CAP=OtherStyle.DEFAULT_LINE_CAP,ctx.CURRENT_LINE_JOIN=OtherStyle.DEFAULT_LINE_JOIN,ctx.CURRENT_MITER_LIMIT=OtherStyle.DEFAULT_MITER_LIMIT,ctx.CURRENT_DIRECTION=OtherStyle.DEFAULT_DIRECTION,ctx.CURRENT_IMAGE_SMOOTHING_ENABLED=OtherStyle.DEFAULT_IMAGE_SMOOTHING_ENABLED,ctx.CURRENT_IMAGE_SMOOTHING_QUALITY=OtherStyle.DEFAULT_IMAGE_SMOOTHING_QUALITY,this},["init","update","draw","contextmenu","resize","visibility"].forEach(function(event){Canvas.prototype[event]=Utils.noop}),Canvas.prototype._initListeners=function(){var throttle,i,touch,$=this;return $.eventListeners={},$.mousedown&&($.eventListeners.mousedown=function(ev){$._x=ev.$x=ev.offsetX,$._y=ev.$y=ev.offsetY,$.mousedown(ev)}),$.touchstart&&($.eventListeners.touchstart=function(ev){for(ev.preventDefault(),i=0;i<ev.targetTouches.length;i++)touch=ev.targetTouches[i],$["_x"+i]=touch.$x=touch.pageX-$.$wrapper.offsetLeft,$["_y"+i]=touch.$y=touch.pageY-$.$wrapper.offsetTop;$.touchstart(ev)}),$.mousemove&&(throttle=function(ev){ev.$moveX=(ev.$x=ev.offsetX)-$._x,ev.$moveY=(ev.$y=ev.offsetY)-$._y,$.mousemove(ev)},$.eventListeners.mousemove=$.$interval?Utils.throttle(throttle,$.$interval,!0):throttle),$.touchmove&&(throttle=function(ev){for(i=0;i<ev.targetTouches.length;i++)(touch=ev.targetTouches[i]).$moveX=(touch.$x=touch.pageX-$.$wrapper.offsetLeft)-$["_x"+i],touch.$moveY=(touch.$y=touch.pageY-$.$wrapper.offsetTop)-$["_y"+i];$.touchmove(ev)},$.eventListeners.touchmove=$.$interval?Utils.throttle(throttle,$.$interval,!0):throttle),$.mouseup&&($.eventListeners.mouseup=$.eventListeners.mouseout=function(ev){ev.$x=ev.offsetX,ev.$y=ev.offsetY,$.mouseup(ev)}),$.touchend&&($.eventListeners.touchend=function(ev){for(i=0;i<ev.targetTouches.length;i++)(touch=ev.targetTouches[i]).$x=touch.pageX-$.$wrapper.offsetLeft,touch.$y=touch.pageY-$.$wrapper.offsetTop;$.touchend(ev)}),$.mouseover&&($.eventListeners.mouseover=function(ev){ev.$x=ev.offsetX,ev.$y=ev.offsetY,$.mouseover(ev)}),$.mouseout&&($.eventListeners.mouseout=function(ev){ev.$x=ev.offsetX,ev.$y=ev.offsetY,$.mouseout(ev)}),$.click&&($.eventListeners.click=function(ev){ev.$x=ev.offsetX,ev.$y=ev.offsetY,$.click(ev)}),$.dblclick&&($.eventListeners.dblclick=function(ev){ev.$x=ev.offsetX,ev.$y=ev.offsetY,$.dblclick(ev)}),$.eventListeners.contextmenu=function(ev){ev.preventDefault(),ev.$x=ev.offsetX,ev.$y=ev.offsetY,$.contextmenu(ev)},$.wheel&&($.eventListeners.wheel=function(ev){ev.preventDefault(),ev.$x=ev.offsetX,ev.$y=ev.offsetY,void 0===$._scale&&($._scale=1),ev.$lastScale=$._scale,$._scale=Math.round($._scale*(0<ev.deltaY?190.2072690095294:344.5504493138832))/256,ev.$scale=$._scale=Math.min(Math.max(.125,$._scale),8),ev.$scaling=ev.$scale/ev.$lastScale,$.wheel(ev)}),$.windowListeners={},$.windowListeners.visibilitychange=function(){$._visible&&$.visibility(!document.hidden)},$.blur&&($.windowListeners.blur=function(ev){$.blur(ev)}),$.focus&&($.windowListeners.focus=function(ev){$.focus(ev)}),$.keydown&&($.windowListeners.keydown=function(ev){ev.isComposing||"Process"===ev.key||$.keydown(ev)}),$.keyup&&($.windowListeners.keyup=function(ev){ev.isComposing||"Process"===ev.key||$.keyup(ev)}),$.keypress&&($.windowListeners.keypress=function(ev){$.keypress(ev)}),$},Canvas.prototype._addListeners=function(){var key,$=this;for(key in $.eventListeners)$.$canvas.addEventListener(key,$.eventListeners[key],{passive:!1});for(key in $.windowListeners)addEventListener(key,$.windowListeners[key],!1);return $},Canvas.prototype._removeListeners=function(){var key,$=this;for(key in $.eventListeners)$.$canvas.removeEventListener(key,$.eventListeners[key],{passive:!1});for(key in $.windowListeners)removeEventListener(key,$.windowListeners[key],!1);return $},Canvas.prototype._deleteListeners=function(){var key,$=this;for(key in $.eventListeners)$.eventListeners[key]=void 0;for(key in $.windowListeners)$.windowListeners[key]=void 0;return $},Canvas.prototype.destroy=function(){var key,$=this;for(key in $._removeListeners(),$._deleteListeners(),$.$raf.stop(),$.$wrapper.removeChild($.$canvas)._context=$.$raf.func=$.$raf._loopBind=void 0,0==--$.$wrapper._count&&(Utils._resizeObserver.unobserve($.$wrapper),Utils._intersectionObserver.unobserve($.$wrapper)),$)delete $[key];return $},{Utils:Utils,Rgb:Rgb,Hsl:Hsl,Matrix:Matrix,FillStrokeStyle:FillStrokeStyle,TextStyle:TextStyle,ShapeStyle:ShapeStyle,ShadowStyle:ShadowStyle,OtherStyle:OtherStyle,Point:Point,Collision:Collision,Config:Config,ImgData:ImgData,Animate:Animate,AnimateITV:AnimateITV,AnimateRAF:AnimateRAF,BasicShape:BasicShape,Shape:Shape,Rect:Rect,RoundRect:RoundRect,Image:Image,Arc:Arc,Sector:Sector,Ellipse:Ellipse,Line:Line,BezierLine:BezierLine,Edge:Edge,ArrowHead:ArrowHead,Arrow:Arrow,RegularPolygon:RegularPolygon,RegularStar:RegularStar,Text:Text,DotShape:DotShape,Polyline:Polyline,Bezier:Bezier,Polygon:Polygon,PolyRect:PolyRect,PolyArc:PolyArc,SmoothLine:SmoothLine,Dots:Dots,FixedShape:FixedShape,FixedRect:FixedRect,FixedArc:FixedArc,Canvas:Canvas}});
